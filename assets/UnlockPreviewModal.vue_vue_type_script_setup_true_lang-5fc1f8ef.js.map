{"version":3,"file":"UnlockPreviewModal.vue_vue_type_script_setup_true_lang-5fc1f8ef.js","sources":["../../src/components/forms/lock_actions/UnlockForm/components/UnlockPreviewModal/components/UnlockActions.vue","../../src/components/forms/lock_actions/UnlockForm/components/UnlockPreviewModal/components/UnlockAmount.vue","../../src/components/forms/lock_actions/UnlockForm/components/UnlockPreviewModal/components/UnlockSummary.vue","../../src/components/forms/lock_actions/UnlockForm/components/UnlockPreviewModal/UnlockPreviewModal.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport {\r\n  TransactionReceipt,\r\n  TransactionResponse,\r\n} from '@ethersproject/abstract-provider';\r\nimport { reactive, ref } from 'vue';\r\nimport { useI18n } from 'vue-i18n';\r\n\r\nimport useConfig from '@/composables/useConfig';\r\nimport useEthers from '@/composables/useEthers';\r\nimport useNumbers, { FNumFormats } from '@/composables/useNumbers';\r\nimport { dateTimeLabelFor } from '@/composables/useTime';\r\nimport useTransactions from '@/composables/useTransactions';\r\nimport { balancerContractsService } from '@/services/balancer/contracts/balancer-contracts.service';\r\nimport useWeb3 from '@/services/web3/useWeb3';\r\nimport { TokenInfo } from '@/types/TokenList';\r\nimport { TransactionActionInfo } from '@/types/transactions';\r\n\r\n/**\r\n * TYPES\r\n */\r\ntype Props = {\r\n  lockablePoolTokenInfo: TokenInfo;\r\n  totalLpTokens: string;\r\n};\r\n\r\ntype UnlockActionState = {\r\n  init: boolean;\r\n  confirming: boolean;\r\n  confirmed: boolean;\r\n  confirmedAt: string;\r\n  receipt?: TransactionReceipt;\r\n};\r\n\r\n/**\r\n * PROPS & EMITS\r\n */\r\nconst props = defineProps<Props>();\r\n\r\nconst emit = defineEmits<{\r\n  (e: 'success', value: UnlockActionState): void;\r\n  (e: 'close'): void;\r\n}>();\r\n\r\n/**\r\n * STATE\r\n */\r\nconst unlockActionState = reactive<UnlockActionState>({\r\n  init: false,\r\n  confirming: false,\r\n  confirmed: false,\r\n  confirmedAt: '',\r\n});\r\n\r\n/**\r\n * COMPOSABLES\r\n */\r\nconst { t } = useI18n();\r\nconst { networkConfig } = useConfig();\r\nconst { getProvider, explorerLinks } = useWeb3();\r\nconst { addTransaction } = useTransactions();\r\nconst { txListener, getTxConfirmedAt } = useEthers();\r\n\r\nconst { fNum } = useNumbers();\r\n\r\nconst unlockAction: TransactionActionInfo = {\r\n  label: t(`unlockVeBAL.previewModal.actions.unlock.label`),\r\n  loadingLabel: t(`unlockVeBAL.previewModal.actions.unlock.loadingLabel`),\r\n  confirmingLabel: t(`unlockVeBAL.previewModal.actions.unlock.confirming`),\r\n  action: submit,\r\n  stepTooltip: t(`unlockVeBAL.previewModal.actions.unlock.tooltip`),\r\n};\r\n\r\nconst actions = ref<TransactionActionInfo[]>([unlockAction]);\r\n\r\n/**\r\n * METHODS\r\n */\r\nasync function handleTransaction(tx: TransactionResponse): Promise<void> {\r\n  addTransaction({\r\n    id: tx.hash,\r\n    type: 'tx',\r\n    action: 'unlock',\r\n    summary: `${fNum(props.totalLpTokens, FNumFormats.token)} ${\r\n      props.lockablePoolTokenInfo.symbol\r\n    }`,\r\n    details: {\r\n      totalLpTokens: props.totalLpTokens,\r\n    },\r\n  });\r\n\r\n  unlockActionState.confirmed = await txListener(tx, {\r\n    onTxConfirmed: async (receipt: TransactionReceipt) => {\r\n      emit('success', unlockActionState);\r\n\r\n      unlockActionState.confirming = false;\r\n      unlockActionState.receipt = receipt;\r\n\r\n      const confirmedAt = await getTxConfirmedAt(receipt);\r\n      unlockActionState.confirmedAt = dateTimeLabelFor(confirmedAt);\r\n    },\r\n    onTxFailed: () => {\r\n      unlockActionState.confirming = false;\r\n    },\r\n  });\r\n}\r\n\r\nasync function submit() {\r\n  try {\r\n    let tx: TransactionResponse;\r\n    unlockActionState.init = true;\r\n\r\n    tx = await balancerContractsService.veBAL.unlock(getProvider());\r\n\r\n    unlockActionState.init = false;\r\n    unlockActionState.confirming = true;\r\n\r\n    console.log('Receipt', tx);\r\n\r\n    handleTransaction(tx);\r\n    return tx;\r\n  } catch (error) {\r\n    console.error(error);\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <BalActionSteps v-if=\"!unlockActionState.confirmed\" :actions=\"actions\" />\r\n    <template v-else>\r\n      <div\r\n        class=\"flex justify-between items-center mt-4 text-sm text-gray-400 dark:text-gray-600\"\r\n      >\r\n        <div class=\"flex items-center\">\r\n          <BalIcon name=\"clock\" />\r\n          <span class=\"ml-2\">\r\n            {{ unlockActionState.confirmedAt }}\r\n          </span>\r\n        </div>\r\n        <BalLink\r\n          v-if=\"unlockActionState.receipt\"\r\n          :href=\"\r\n            explorerLinks.txLink(unlockActionState.receipt.transactionHash)\r\n          \"\r\n          external\r\n          noStyle\r\n          class=\"group flex items-center\"\r\n        >\r\n          {{ networkConfig.explorerName }}\r\n          <BalIcon\r\n            name=\"arrow-up-right\"\r\n            size=\"sm\"\r\n            class=\"ml-px group-hover:text-pink-500 transition-colors\"\r\n          />\r\n        </BalLink>\r\n      </div>\r\n      <BalBtn color=\"gray\" outline block class=\"mt-2\" @click=\"emit('close')\">\r\n        {{ $t('unlockVeBAL.previewModal.returnToVeBalPage') }}\r\n      </BalBtn>\r\n    </template>\r\n  </div>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { computed } from 'vue';\r\n\r\nimport useNumbers, { FNumFormats } from '@/composables/useNumbers';\r\nimport { useTokens } from '@/providers/tokens.provider';\r\nimport { Pool } from '@/services/pool/types';\r\nimport { PoolToken } from '@balancer-labs/sdk';\r\n\r\n/**\r\n * TYPES\r\n */\r\ntype Props = {\r\n  lockablePool: Pool;\r\n  totalLpTokens: string;\r\n};\r\n\r\n/**\r\n * PROPS\r\n */\r\nconst props = defineProps<Props>();\r\n\r\n/**\r\n * COMPOSABLES\r\n */\r\nconst { getToken } = useTokens();\r\nconst { fNum } = useNumbers();\r\n\r\n/**\r\n * COMPUTED\r\n */\r\nconst poolWeightsLabel = computed(() =>\r\n  props.lockablePool.tokens\r\n    .map(token => {\r\n      const weightLabel = formatWeightLabel(token.weight);\r\n      const symbol = token.symbol ?? getToken(token.address).symbol;\r\n\r\n      return `${weightLabel} ${symbol}`;\r\n    })\r\n    .join(' / ')\r\n);\r\n\r\n/**\r\n * METHODS\r\n */\r\nfunction formatWeightLabel(weight: PoolToken['weight']) {\r\n  return fNum(weight || '0', {\r\n    style: 'percent',\r\n    maximumFractionDigits: 0,\r\n  });\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"container\">\r\n    <div class=\"flex justify-between items-center p-3\">\r\n      <div>\r\n        <div class=\"font-semibold\">\r\n          {{\r\n            $t('getVeBAL.previewModal.lpTokens', [\r\n              fNum(totalLpTokens, FNumFormats.token),\r\n            ])\r\n          }}\r\n        </div>\r\n        <div class=\"text-gray-400 dark:text-gray-600\">\r\n          {{ poolWeightsLabel }}\r\n        </div>\r\n      </div>\r\n      <div class=\"grid grid-cols-2 gap-1\">\r\n        <BalAsset\r\n          v-for=\"tokenAddress in lockablePool.tokensList\"\r\n          :key=\"tokenAddress\"\r\n          :address=\"tokenAddress\"\r\n          :size=\"30\"\r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.container {\r\n  @apply shadow-lg border dark:border-gray-700 divide-y dark:divide-gray-700 rounded-lg;\r\n}\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { format } from 'date-fns';\r\n\r\nimport { PRETTY_DATE_FORMAT } from '@/components/forms/lock_actions/constants';\r\nimport useNumbers, { FNumFormats } from '@/composables/useNumbers';\r\nimport useVeBal from '@/composables/useVeBAL';\r\nimport { VeBalLockInfo } from '@/services/balancer/contracts/contracts/veBAL';\r\n\r\n/**\r\n * TYPES\r\n */\r\ntype Props = {\r\n  fiatTotalLpTokens: string;\r\n  veBalLockInfo: VeBalLockInfo;\r\n};\r\n\r\n/**\r\n * PROPS\r\n */\r\ndefineProps<Props>();\r\n\r\n/**\r\n * COMPOSABLES\r\n */\r\nconst { fNum } = useNumbers();\r\nconst { veBalTokenInfo } = useVeBal();\r\n\r\n/**\r\n * COMPUTED\r\n */\r\n</script>\r\n\r\n<template>\r\n  <div class=\"summary-table\">\r\n    <h6 class=\"p-2\">\r\n      {{ $t('unlockVeBAL.previewModal.summary.title') }}\r\n    </h6>\r\n    <div class=\"p-2\">\r\n      <div class=\"summary-item-row\">\r\n        <div>\r\n          {{ $t('unlockVeBAL.previewModal.summary.totalToUnlock') }}\r\n        </div>\r\n        <div>\r\n          {{ fNum(fiatTotalLpTokens, FNumFormats.fiat) }}\r\n        </div>\r\n      </div>\r\n      <div class=\"summary-item-row\">\r\n        <div>\r\n          {{ $t('unlockVeBAL.previewModal.summary.totalVotingEscrow') }}\r\n        </div>\r\n        <div>\r\n          {{ fNum(0, FNumFormats.token) }}\r\n          {{ veBalTokenInfo.symbol }}\r\n        </div>\r\n      </div>\r\n      <div class=\"summary-item-row\">\r\n        <div>\r\n          {{ $t('unlockVeBAL.previewModal.summary.expiredOn') }}\r\n        </div>\r\n        <div>\r\n          {{ format(veBalLockInfo.lockedEndDate, PRETTY_DATE_FORMAT) }}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.summary-table {\r\n  @apply border dark:border-gray-700 divide-y dark:divide-gray-700 rounded-lg mt-4;\r\n}\r\n\r\n.summary-item-row {\r\n  @apply flex justify-between pb-2;\r\n}\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { computed, ref } from 'vue';\r\nimport { useI18n } from 'vue-i18n';\r\n\r\nimport useVeBalLockInfoQuery from '@/composables/queries/useVeBalLockInfoQuery';\r\nimport { VeBalLockInfo } from '@/services/balancer/contracts/contracts/veBAL';\r\nimport { Pool } from '@/services/pool/types';\r\nimport { TokenInfo } from '@/types/TokenList';\r\n\r\nimport UnlockActions from './components/UnlockActions.vue';\r\nimport UnlockAmount from './components/UnlockAmount.vue';\r\nimport UnlockSummary from './components/UnlockSummary.vue';\r\n\r\n/**\r\n * TYPES\r\n */\r\ntype Props = {\r\n  lockablePool: Pool;\r\n  lockablePoolTokenInfo: TokenInfo;\r\n  veBalLockInfo: VeBalLockInfo;\r\n  totalLpTokens: string;\r\n  fiatTotalLpTokens: string;\r\n};\r\n\r\n/**\r\n * PROPS & EMITS\r\n */\r\nconst props = defineProps<Props>();\r\n\r\nconst emit = defineEmits<{\r\n  (e: 'close'): void;\r\n}>();\r\n\r\n/**\r\n * COMPOSABLES\r\n */\r\nconst { refetch: refetchLockInfo } = useVeBalLockInfoQuery();\r\n\r\n/**\r\n * STATE\r\n */\r\nconst unlockConfirmed = ref(false);\r\nconst lockablePool = ref(props.lockablePool);\r\nconst lockablePoolTokenInfo = ref(props.lockablePoolTokenInfo);\r\nconst veBalLockInfo = ref(props.veBalLockInfo);\r\nconst totalLpTokens = ref(props.totalLpTokens);\r\nconst fiatTotalLpTokens = ref(props.fiatTotalLpTokens);\r\n\r\n/**\r\n * COMPOSABLES\r\n */\r\nconst { t } = useI18n();\r\n\r\n/**\r\n * COMPUTED\r\n */\r\nconst title = computed(() => {\r\n  return unlockConfirmed.value\r\n    ? t(`unlockVeBAL.previewModal.titles.unlock.confirmed`)\r\n    : t(`unlockVeBAL.previewModal.titles.unlock.default`);\r\n});\r\n\r\n/**\r\n * METHODS\r\n */\r\nfunction handleClose() {\r\n  emit('close');\r\n}\r\n\r\nfunction handleSuccess() {\r\n  unlockConfirmed.value = true;\r\n  refetchLockInfo();\r\n}\r\n</script>\r\n\r\n<template>\r\n  <BalModal show :fireworks=\"unlockConfirmed\" @close=\"handleClose\">\r\n    <template #header>\r\n      <div class=\"flex items-center\">\r\n        <BalCircle\r\n          v-if=\"unlockConfirmed\"\r\n          size=\"8\"\r\n          color=\"green\"\r\n          class=\"mr-2 text-white\"\r\n        >\r\n          <BalIcon name=\"check\" />\r\n        </BalCircle>\r\n        <h4>\r\n          {{ title }}\r\n        </h4>\r\n      </div>\r\n    </template>\r\n\r\n    <UnlockAmount :lockablePool=\"lockablePool\" :totalLpTokens=\"totalLpTokens\" />\r\n\r\n    <UnlockSummary\r\n      :fiatTotalLpTokens=\"fiatTotalLpTokens\"\r\n      :veBalLockInfo=\"veBalLockInfo\"\r\n    />\r\n\r\n    <UnlockActions\r\n      :lockablePool=\"lockablePool\"\r\n      :lockablePoolTokenInfo=\"lockablePoolTokenInfo\"\r\n      :totalLpTokens=\"totalLpTokens\"\r\n      :veBalLockInfo=\"veBalLockInfo\"\r\n      class=\"mt-4\"\r\n      @success=\"handleSuccess\"\r\n      @close=\"handleClose\"\r\n    />\r\n  </BalModal>\r\n</template>\r\n"],"names":["unlockActionState","reactive","t","useI18n","networkConfig","useConfig","getProvider","explorerLinks","useWeb3","addTransaction","useTransactions","txListener","getTxConfirmedAt","useEthers","fNum","useNumbers","unlockAction","submit","actions","ref","handleTransaction","tx","props","FNumFormats","receipt","emit","confirmedAt","dateTimeLabelFor","balancerContractsService","error","getToken","useTokens","poolWeightsLabel","computed","token","weightLabel","formatWeightLabel","symbol","weight","veBalTokenInfo","useVeBal","refetchLockInfo","useVeBalLockInfoQuery","unlockConfirmed","lockablePool","lockablePoolTokenInfo","veBalLockInfo","totalLpTokens","fiatTotalLpTokens","title","handleClose","handleSuccess"],"mappings":"yxBA+CAA,EAAAC,EAAA,CAAsD,KAAA,GAC9C,WAAA,GACM,UAAA,GACD,YAAA,EACE,CAAA,EAMf,CAAA,EAAAC,GAAAC,IACA,CAAA,cAAAC,GAAAC,IACA,CAAA,YAAAC,EAAA,cAAAC,CAAA,EAAAC,EAAA,EACA,CAAA,eAAAC,GAAAC,IACA,CAAA,WAAAC,EAAA,iBAAAC,CAAA,EAAAC,EAAA,EAEA,CAAA,KAAAC,GAAAC,IAEAC,EAAA,CAA4C,MAAAd,EAAA,+CAAA,EACc,aAAAA,EAAA,sDAAA,EACc,gBAAAA,EAAA,oDAAA,EACC,OAAAe,EAC/D,YAAAf,EAAA,iDAAA,CACwD,EAGlEgB,EAAAC,EAAA,CAAAH,CAAA,CAAA,EAKA,eAAAI,EAAAC,EAAA,CACEZ,EAAA,CAAe,GAAAY,EAAA,KACN,KAAA,KACD,OAAA,SACE,QAAA,GAAAP,EAAAQ,EAAA,cAAAC,EAAA,KAAA,KAAAD,EAAA,sBAAA,SAEsB,QAAA,CAErB,cAAAA,EAAA,aACc,CACvB,CAAA,EAGFtB,EAAA,UAAA,MAAAW,EAAAU,EAAA,CAAmD,cAAA,MAAAG,GAAA,CAE/CC,EAAA,UAAAzB,CAAA,EAEAA,EAAA,WAAA,GACAA,EAAA,QAAAwB,EAEA,MAAAE,EAAA,MAAAd,EAAAY,CAAA,EACAxB,EAAA,YAAA2B,EAAAD,CAAA,CAA4D,EAC9D,WAAA,IAAA,CAEE1B,EAAA,WAAA,EAA+B,CACjC,CAAA,CACD,CAGH,eAAAiB,GAAA,CACE,GAAA,CACE,IAAAI,EACA,OAAArB,EAAA,KAAA,GAEAqB,EAAA,MAAAO,EAAA,MAAA,OAAAtB,EAAA,CAAA,EAEAN,EAAA,KAAA,GACAA,EAAA,WAAA,GAEA,QAAA,IAAA,UAAAqB,CAAA,EAEAD,EAAAC,CAAA,EACAA,CAAO,OAAAQ,EAAA,CAEP,eAAA,MAAAA,CAAA,EACA,QAAA,OAAAA,CAAA,CAA2B,CAC7B,u9BCpGF,CAAA,SAAAC,GAAAC,IACA,CAAA,KAAAjB,GAAAC,IAKAiB,EAAAC,EAAyB,IAAAX,EAAA,aAAA,OAAA,IAAAY,GAAA,CAGnB,MAAAC,EAAAC,EAAAF,EAAA,MAAA,EACAG,EAAAH,EAAA,QAAAJ,EAAAI,EAAA,OAAA,EAAA,OAEA,MAAA,GAAAC,KAAAE,GAAyB,CAAA,EAAA,KAAA,KAAA,CAEhB,EAMf,SAAAD,EAAAE,EAAA,CACE,OAAAxB,EAAAwB,GAAA,IAAA,CAA2B,MAAA,UAClB,sBAAA,CACgB,CAAA,CACxB,kmBCxBH,KAAA,CAAA,KAAAxB,GAAAC,IACA,CAAA,eAAAwB,GAAAC,2zBCWA,CAAA,QAAAC,CAAA,EAAAC,EAAA,EAKAC,EAAAxB,EAAA,EAAA,EACAyB,EAAAzB,EAAAG,EAAA,YAAA,EACAuB,EAAA1B,EAAAG,EAAA,qBAAA,EACAwB,EAAA3B,EAAAG,EAAA,aAAA,EACAyB,EAAA5B,EAAAG,EAAA,aAAA,EACA0B,EAAA7B,EAAAG,EAAA,iBAAA,EAKA,CAAA,EAAApB,GAAAC,IAKA8C,EAAAhB,EAAA,IACEU,EAAA,MAAAzC,EAAA,kDAAA,EAAAA,EAAA,gDAAA,CAEsD,EAMxD,SAAAgD,GAAA,CACEzB,EAAA,OAAA,CAAY,CAGd,SAAA0B,GAAA,CACER,EAAA,MAAA,GACAF,GAAgB"}