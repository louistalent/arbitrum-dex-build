import{bL as ne,gs as gr,gC as Ir,gB as Nr,gk as wr,eD as W}from"./index-4a1c513c.js";const{Transform:xr}=gr;var $r=e=>class vr extends xr{constructor(r,n,s,i,o){super(o),this._rate=r,this._capacity=n,this._delimitedSuffix=s,this._hashBitLength=i,this._options=o,this._state=new e,this._state.initialize(r,n),this._finalized=!1}_transform(r,n,s){let i=null;try{this.update(r,n)}catch(o){i=o}s(i)}_flush(r){let n=null;try{this.push(this.digest())}catch(s){n=s}r(n)}update(r,n){if(!ne.isBuffer(r)&&typeof r!="string")throw new TypeError("Data must be a string or a buffer");if(this._finalized)throw new Error("Digest already called");return ne.isBuffer(r)||(r=ne.from(r,n)),this._state.absorb(r),this}digest(r){if(this._finalized)throw new Error("Digest already called");this._finalized=!0,this._delimitedSuffix&&this._state.absorbLastFewBits(this._delimitedSuffix);let n=this._state.squeeze(this._hashBitLength/8);return r!==void 0&&(n=n.toString(r)),this._resetState(),n}_resetState(){return this._state.initialize(this._rate,this._capacity),this}_clone(){const r=new vr(this._rate,this._capacity,this._delimitedSuffix,this._hashBitLength,this._options);return this._state.copy(r._state),r._finalized=this._finalized,r}};const{Transform:zr}=gr;var Hr=e=>class br extends zr{constructor(r,n,s,i){super(i),this._rate=r,this._capacity=n,this._delimitedSuffix=s,this._options=i,this._state=new e,this._state.initialize(r,n),this._finalized=!1}_transform(r,n,s){let i=null;try{this.update(r,n)}catch(o){i=o}s(i)}_flush(){}_read(r){this.push(this.squeeze(r))}update(r,n){if(!ne.isBuffer(r)&&typeof r!="string")throw new TypeError("Data must be a string or a buffer");if(this._finalized)throw new Error("Squeeze already called");return ne.isBuffer(r)||(r=ne.from(r,n)),this._state.absorb(r),this}squeeze(r,n){this._finalized||(this._finalized=!0,this._state.absorbLastFewBits(this._delimitedSuffix));let s=this._state.squeeze(r);return n!==void 0&&(s=s.toString(n)),s}_resetState(){return this._state.initialize(this._rate,this._capacity),this}_clone(){const r=new br(this._rate,this._capacity,this._delimitedSuffix,this._options);return this._state.copy(r._state),r._finalized=this._finalized,r}};const Dr=$r,qr=Hr;var Ur=function(e){const t=Dr(e),r=qr(e);return function(n,s){switch(typeof n=="string"?n.toLowerCase():n){case"keccak224":return new t(1152,448,null,224,s);case"keccak256":return new t(1088,512,null,256,s);case"keccak384":return new t(832,768,null,384,s);case"keccak512":return new t(576,1024,null,512,s);case"sha3-224":return new t(1152,448,6,224,s);case"sha3-256":return new t(1088,512,6,256,s);case"sha3-384":return new t(832,768,6,384,s);case"sha3-512":return new t(576,1024,6,512,s);case"shake128":return new r(1344,256,31,s);case"shake256":return new r(1088,512,31,s);default:throw new Error("Invald algorithm: "+n)}}},Er={};const sr=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648];Er.p1600=function(e){for(let t=0;t<24;++t){const r=e[0]^e[10]^e[20]^e[30]^e[40],n=e[1]^e[11]^e[21]^e[31]^e[41],s=e[2]^e[12]^e[22]^e[32]^e[42],i=e[3]^e[13]^e[23]^e[33]^e[43],o=e[4]^e[14]^e[24]^e[34]^e[44],u=e[5]^e[15]^e[25]^e[35]^e[45],d=e[6]^e[16]^e[26]^e[36]^e[46],y=e[7]^e[17]^e[27]^e[37]^e[47],R=e[8]^e[18]^e[28]^e[38]^e[48],F=e[9]^e[19]^e[29]^e[39]^e[49];let p=R^(s<<1|i>>>31),_=F^(i<<1|s>>>31);const P=e[0]^p,I=e[1]^_,x=e[10]^p,O=e[11]^_,E=e[20]^p,g=e[21]^_,L=e[30]^p,M=e[31]^_,J=e[40]^p,X=e[41]^_;p=r^(o<<1|u>>>31),_=n^(u<<1|o>>>31);const ie=e[2]^p,oe=e[3]^_,Y=e[12]^p,le=e[13]^_,fe=e[22]^p,Z=e[23]^_,S=e[32]^p,ee=e[33]^_,te=e[42]^p,a=e[43]^_;p=s^(d<<1|y>>>31),_=i^(y<<1|d>>>31);const c=e[4]^p,l=e[5]^_,f=e[14]^p,m=e[15]^_,h=e[24]^p,w=e[25]^_,k=e[34]^p,N=e[35]^_,v=e[44]^p,C=e[45]^_;p=o^(R<<1|F>>>31),_=u^(F<<1|R>>>31);const j=e[6]^p,T=e[7]^_,$=e[16]^p,D=e[17]^_,q=e[26]^p,U=e[27]^_,G=e[36]^p,Jt=e[37]^_,Vt=e[46]^p,Gt=e[47]^_;p=d^(r<<1|n>>>31),_=y^(n<<1|r>>>31);const Wt=e[8]^p,Kt=e[9]^_,Qt=e[18]^p,Xt=e[19]^_,Yt=e[28]^p,Zt=e[29]^_,er=e[38]^p,tr=e[39]^_,rr=e[48]^p,nr=e[49]^_,je=P,Ae=I,Ie=O<<4|x>>>28,Ne=x<<4|O>>>28,xe=E<<3|g>>>29,$e=g<<3|E>>>29,ze=M<<9|L>>>23,He=L<<9|M>>>23,De=J<<18|X>>>14,qe=X<<18|J>>>14,Ue=ie<<1|oe>>>31,Je=oe<<1|ie>>>31,Ve=le<<12|Y>>>20,Ge=Y<<12|le>>>20,We=fe<<10|Z>>>22,Ke=Z<<10|fe>>>22,Qe=ee<<13|S>>>19,Xe=S<<13|ee>>>19,Ye=te<<2|a>>>30,Ze=a<<2|te>>>30,et=l<<30|c>>>2,tt=c<<30|l>>>2,rt=f<<6|m>>>26,nt=m<<6|f>>>26,st=w<<11|h>>>21,it=h<<11|w>>>21,ot=k<<15|N>>>17,at=N<<15|k>>>17,ct=C<<29|v>>>3,ut=v<<29|C>>>3,lt=j<<28|T>>>4,ft=T<<28|j>>>4,dt=D<<23|$>>>9,ht=$<<23|D>>>9,pt=q<<25|U>>>7,mt=U<<25|q>>>7,yt=G<<21|Jt>>>11,_t=Jt<<21|G>>>11,gt=Gt<<24|Vt>>>8,wt=Vt<<24|Gt>>>8,vt=Wt<<27|Kt>>>5,bt=Kt<<27|Wt>>>5,Et=Qt<<20|Xt>>>12,Rt=Xt<<20|Qt>>>12,Bt=Zt<<7|Yt>>>25,St=Yt<<7|Zt>>>25,kt=er<<8|tr>>>24,Pt=tr<<8|er>>>24,Ft=rr<<14|nr>>>18,Ct=nr<<14|rr>>>18;e[0]=je^~Ve&st,e[1]=Ae^~Ge&it,e[10]=lt^~Et&xe,e[11]=ft^~Rt&$e,e[20]=Ue^~rt&pt,e[21]=Je^~nt&mt,e[30]=vt^~Ie&We,e[31]=bt^~Ne&Ke,e[40]=et^~dt&Bt,e[41]=tt^~ht&St,e[2]=Ve^~st&yt,e[3]=Ge^~it&_t,e[12]=Et^~xe&Qe,e[13]=Rt^~$e&Xe,e[22]=rt^~pt&kt,e[23]=nt^~mt&Pt,e[32]=Ie^~We&ot,e[33]=Ne^~Ke&at,e[42]=dt^~Bt&ze,e[43]=ht^~St&He,e[4]=st^~yt&Ft,e[5]=it^~_t&Ct,e[14]=xe^~Qe&ct,e[15]=$e^~Xe&ut,e[24]=pt^~kt&De,e[25]=mt^~Pt&qe,e[34]=We^~ot&gt,e[35]=Ke^~at&wt,e[44]=Bt^~ze&Ye,e[45]=St^~He&Ze,e[6]=yt^~Ft&je,e[7]=_t^~Ct&Ae,e[16]=Qe^~ct&lt,e[17]=Xe^~ut&ft,e[26]=kt^~De&Ue,e[27]=Pt^~qe&Je,e[36]=ot^~gt&vt,e[37]=at^~wt&bt,e[46]=ze^~Ye&et,e[47]=He^~Ze&tt,e[8]=Ft^~je&Ve,e[9]=Ct^~Ae&Ge,e[18]=ct^~lt&Et,e[19]=ut^~ft&Rt,e[28]=De^~Ue&rt,e[29]=qe^~Je&nt,e[38]=gt^~vt&Ie,e[39]=wt^~bt&Ne,e[48]=Ye^~et&dt,e[49]=Ze^~tt&ht,e[0]^=sr[t*2],e[1]^=sr[t*2+1]}};const Re=Er;function ue(){this.state=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.blockSize=null,this.count=0,this.squeezing=!1}ue.prototype.initialize=function(e,t){for(let r=0;r<50;++r)this.state[r]=0;this.blockSize=e/8,this.count=0,this.squeezing=!1};ue.prototype.absorb=function(e){for(let t=0;t<e.length;++t)this.state[~~(this.count/4)]^=e[t]<<8*(this.count%4),this.count+=1,this.count===this.blockSize&&(Re.p1600(this.state),this.count=0)};ue.prototype.absorbLastFewBits=function(e){this.state[~~(this.count/4)]^=e<<8*(this.count%4),e&128&&this.count===this.blockSize-1&&Re.p1600(this.state),this.state[~~((this.blockSize-1)/4)]^=128<<8*((this.blockSize-1)%4),Re.p1600(this.state),this.count=0,this.squeezing=!0};ue.prototype.squeeze=function(e){this.squeezing||this.absorbLastFewBits(1);const t=ne.alloc(e);for(let r=0;r<e;++r)t[r]=this.state[~~(this.count/4)]>>>8*(this.count%4)&255,this.count+=1,this.count===this.blockSize&&(Re.p1600(this.state),this.count=0);return t};ue.prototype.copy=function(e){for(let t=0;t<50;++t)e.state[t]=this.state[t];e.blockSize=this.blockSize,e.count=this.count,e.squeezing=this.squeezing};var Jr=ue,As=Ur(Jr);const ir=(e,t)=>function(){const r=t.promiseModule,n=new Array(arguments.length);for(let s=0;s<arguments.length;s++)n[s]=arguments[s];return new r((s,i)=>{t.errorFirst?n.push(function(o,u){if(t.multiArgs){const d=new Array(arguments.length-1);for(let y=1;y<arguments.length;y++)d[y-1]=arguments[y];o?(d.unshift(o),i(d)):s(d)}else o?i(o):s(u)}):n.push(function(o){if(t.multiArgs){const u=new Array(arguments.length-1);for(let d=0;d<arguments.length;d++)u[d]=arguments[d];s(u)}else s(o)}),e.apply(this,n)})};var Vr=(e,t)=>{t=Object.assign({exclude:[/.+(Sync|Stream)$/],errorFirst:!0,promiseModule:Promise},t);const r=s=>{const i=o=>typeof o=="string"?s===o:o.test(s);return t.include?t.include.some(i):!t.exclude.some(i)};let n;typeof e=="function"?n=function(){return t.excludeMain?e.apply(this,arguments):ir(e,t).apply(this,arguments)}:n=Object.create(Object.getPrototypeOf(e));for(const s in e){const i=e[s];n[s]=typeof i=="function"&&r(s)?ir(i,t):i}return n},Gr=Wr;function Wr(e){e=e||{};var t=e.max||Number.MAX_SAFE_INTEGER,r=typeof e.start<"u"?e.start:Math.floor(Math.random()*t);return function(){return r=r%t,r++}}const Kr=Ir,Qr=Gr();var Xr=b;function b(e){const t=this;t.currentProvider=e}b.prototype.getBalance=me(2,"eth_getBalance");b.prototype.getCode=me(2,"eth_getCode");b.prototype.getTransactionCount=me(2,"eth_getTransactionCount");b.prototype.getStorageAt=me(3,"eth_getStorageAt");b.prototype.call=me(2,"eth_call");b.prototype.protocolVersion=B("eth_protocolVersion");b.prototype.syncing=B("eth_syncing");b.prototype.coinbase=B("eth_coinbase");b.prototype.mining=B("eth_mining");b.prototype.hashrate=B("eth_hashrate");b.prototype.gasPrice=B("eth_gasPrice");b.prototype.accounts=B("eth_accounts");b.prototype.blockNumber=B("eth_blockNumber");b.prototype.getBlockTransactionCountByHash=B("eth_getBlockTransactionCountByHash");b.prototype.getBlockTransactionCountByNumber=B("eth_getBlockTransactionCountByNumber");b.prototype.getUncleCountByBlockHash=B("eth_getUncleCountByBlockHash");b.prototype.getUncleCountByBlockNumber=B("eth_getUncleCountByBlockNumber");b.prototype.sign=B("eth_sign");b.prototype.sendTransaction=B("eth_sendTransaction");b.prototype.sendRawTransaction=B("eth_sendRawTransaction");b.prototype.estimateGas=B("eth_estimateGas");b.prototype.getBlockByHash=B("eth_getBlockByHash");b.prototype.getBlockByNumber=B("eth_getBlockByNumber");b.prototype.getTransactionByHash=B("eth_getTransactionByHash");b.prototype.getTransactionByBlockHashAndIndex=B("eth_getTransactionByBlockHashAndIndex");b.prototype.getTransactionByBlockNumberAndIndex=B("eth_getTransactionByBlockNumberAndIndex");b.prototype.getTransactionReceipt=B("eth_getTransactionReceipt");b.prototype.getUncleByBlockHashAndIndex=B("eth_getUncleByBlockHashAndIndex");b.prototype.getUncleByBlockNumberAndIndex=B("eth_getUncleByBlockNumberAndIndex");b.prototype.getCompilers=B("eth_getCompilers");b.prototype.compileLLL=B("eth_compileLLL");b.prototype.compileSolidity=B("eth_compileSolidity");b.prototype.compileSerpent=B("eth_compileSerpent");b.prototype.newFilter=B("eth_newFilter");b.prototype.newBlockFilter=B("eth_newBlockFilter");b.prototype.newPendingTransactionFilter=B("eth_newPendingTransactionFilter");b.prototype.uninstallFilter=B("eth_uninstallFilter");b.prototype.getFilterChanges=B("eth_getFilterChanges");b.prototype.getFilterLogs=B("eth_getFilterLogs");b.prototype.getLogs=B("eth_getLogs");b.prototype.getWork=B("eth_getWork");b.prototype.submitWork=B("eth_submitWork");b.prototype.submitHashrate=B("eth_submitHashrate");b.prototype.sendAsync=function(e,t){this.currentProvider.sendAsync(Yr(e),function(n,s){if(!n&&s.error&&(n=new Error("EthQuery - RPC Error - "+s.error.message)),n)return t(n);t(null,s.result)})};function B(e){return function(){const t=this;var r=[].slice.call(arguments),n=r.pop();t.sendAsync({method:e,params:r},n)}}function me(e,t){return function(){const r=this;var n=[].slice.call(arguments),s=n.pop();n.length<e&&n.push("latest"),r.sendAsync({method:t,params:n},s)}}function Yr(e){return Kr({id:Qr(),jsonrpc:"2.0",params:[]},e)}const Zr=Nr,Rr=wr;var Ot=typeof Reflect=="object"?Reflect:null,en=Ot&&typeof Ot.apply=="function"?Ot.apply:function(t,r,n){return Function.prototype.apply.call(t,r,n)},tn=Nt;function Nt(){Rr.call(this)}Zr.inherits(Nt,Rr);Nt.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var o=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw o.context=i,o}var u=s[e];if(u===void 0)return!1;if(typeof u=="function")or(u,this,t);else for(var d=u.length,y=rn(u,d),r=0;r<d;++r)or(y[r],this,t);return!0};function or(e,t,r){try{en(e,t,r)}catch(n){setTimeout(()=>{throw n})}}function rn(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}const nn=tn,sn=1e3,on=(e,t)=>e+t,ar=["sync","latest"];let an=class extends nn{constructor(t={}){super(),this._blockResetDuration=t.blockResetDuration||20*sn,this._blockResetTimeout,this._currentBlock=null,this._isRunning=!1,this._onNewListener=this._onNewListener.bind(this),this._onRemoveListener=this._onRemoveListener.bind(this),this._resetCurrentBlock=this._resetCurrentBlock.bind(this),this._setupInternalEvents()}isRunning(){return this._isRunning}getCurrentBlock(){return this._currentBlock}async getLatestBlock(){return this._currentBlock?this._currentBlock:await new Promise(r=>this.once("latest",r))}removeAllListeners(t){t?super.removeAllListeners(t):super.removeAllListeners(),this._setupInternalEvents(),this._onRemoveListener()}_start(){}_end(){}_setupInternalEvents(){this.removeListener("newListener",this._onNewListener),this.removeListener("removeListener",this._onRemoveListener),this.on("newListener",this._onNewListener),this.on("removeListener",this._onRemoveListener)}_onNewListener(t,r){ar.includes(t)&&this._maybeStart()}_onRemoveListener(t,r){this._getBlockTrackerEventCount()>0||this._maybeEnd()}_maybeStart(){this._isRunning||(this._isRunning=!0,this._cancelBlockResetTimeout(),this._start())}_maybeEnd(){this._isRunning&&(this._isRunning=!1,this._setupBlockResetTimeout(),this._end())}_getBlockTrackerEventCount(){return ar.map(t=>this.listenerCount(t)).reduce(on)}_newPotentialLatest(t){const r=this._currentBlock;r&&cr(t)<=cr(r)||this._setCurrentBlock(t)}_setCurrentBlock(t){const r=this._currentBlock;this._currentBlock=t,this.emit("latest",t),this.emit("sync",{oldBlock:r,newBlock:t})}_setupBlockResetTimeout(){this._cancelBlockResetTimeout(),this._blockResetTimeout=setTimeout(this._resetCurrentBlock,this._blockResetDuration),this._blockResetTimeout.unref&&this._blockResetTimeout.unref()}_cancelBlockResetTimeout(){clearTimeout(this._blockResetTimeout)}_resetCurrentBlock(){this._currentBlock=null}};var cn=an;function cr(e){return Number.parseInt(e,16)}const un=Vr,ln=cn,fn=1e3;class dn extends ln{constructor(t={}){if(!t.provider)throw new Error("PollingBlockTracker - no provider specified.");const r=t.pollingInterval||20*fn,n=t.retryTimeout||r/10,s=t.keepEventLoopActive!==void 0?t.keepEventLoopActive:!0,i=t.setSkipCacheFlag||!1;super(Object.assign({blockResetDuration:r},t)),this._provider=t.provider,this._pollingInterval=r,this._retryTimeout=n,this._keepEventLoopActive=s,this._setSkipCacheFlag=i}async checkForLatestBlock(){return await this._updateLatestBlock(),await this.getLatestBlock()}_start(){this._performSync().catch(t=>this.emit("error",t))}async _performSync(){for(;this._isRunning;)try{await this._updateLatestBlock(),await ur(this._pollingInterval,!this._keepEventLoopActive)}catch(t){const r=new Error(`PollingBlockTracker - encountered an error while attempting to update latest block:
${t.stack}`);try{this.emit("error",r)}catch{console.error(r)}await ur(this._retryTimeout,!this._keepEventLoopActive)}}async _updateLatestBlock(){const t=await this._fetchLatestBlock();this._newPotentialLatest(t)}async _fetchLatestBlock(){const t={jsonrpc:"2.0",id:1,method:"eth_blockNumber",params:[]};this._setSkipCacheFlag&&(t.skipCache=!0);const r=await un(n=>this._provider.sendAsync(t,n))();if(r.error)throw new Error(`PollingBlockTracker - encountered error fetching block:
${r.error}`);return r.result}}var Ns=dn;function ur(e,t){return new Promise(r=>{const n=setTimeout(r,e);n.unref&&t&&n.unref()})}var Br={},xt={},he={},hn={get exports(){return he},set exports(e){he=e}};(function(e){var t,r,n,s,i,o,u,d,y,R,F,p,_,P,I,x,O,E,g,L,M,J,X,ie,oe,Y,le,fe,Z;(function(S){var ee=typeof W=="object"?W:typeof self=="object"?self:typeof this=="object"?this:{};S(te(ee,te(e.exports)));function te(a,c){return a!==ee&&(typeof Object.create=="function"?Object.defineProperty(a,"__esModule",{value:!0}):a.__esModule=!0),function(l,f){return a[l]=c?c(l,f):f}}})(function(S){var ee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(a[l]=c[l])};t=function(a,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");ee(a,c);function l(){this.constructor=a}a.prototype=c===null?Object.create(c):(l.prototype=c.prototype,new l)},r=Object.assign||function(a){for(var c,l=1,f=arguments.length;l<f;l++){c=arguments[l];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&(a[m]=c[m])}return a},n=function(a,c){var l={};for(var f in a)Object.prototype.hasOwnProperty.call(a,f)&&c.indexOf(f)<0&&(l[f]=a[f]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,f=Object.getOwnPropertySymbols(a);m<f.length;m++)c.indexOf(f[m])<0&&Object.prototype.propertyIsEnumerable.call(a,f[m])&&(l[f[m]]=a[f[m]]);return l},s=function(a,c,l,f){var m=arguments.length,h=m<3?c:f===null?f=Object.getOwnPropertyDescriptor(c,l):f,w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(a,c,l,f);else for(var k=a.length-1;k>=0;k--)(w=a[k])&&(h=(m<3?w(h):m>3?w(c,l,h):w(c,l))||h);return m>3&&h&&Object.defineProperty(c,l,h),h},i=function(a,c){return function(l,f){c(l,f,a)}},o=function(a,c,l,f,m,h){function w(G){if(G!==void 0&&typeof G!="function")throw new TypeError("Function expected");return G}for(var k=f.kind,N=k==="getter"?"get":k==="setter"?"set":"value",v=!c&&a?f.static?a:a.prototype:null,C=c||(v?Object.getOwnPropertyDescriptor(v,f.name):{}),j,T=!1,$=l.length-1;$>=0;$--){var D={};for(var q in f)D[q]=q==="access"?{}:f[q];for(var q in f.access)D.access[q]=f.access[q];D.addInitializer=function(G){if(T)throw new TypeError("Cannot add initializers after decoration has completed");h.push(w(G||null))};var U=(0,l[$])(k==="accessor"?{get:C.get,set:C.set}:C[N],D);if(k==="accessor"){if(U===void 0)continue;if(U===null||typeof U!="object")throw new TypeError("Object expected");(j=w(U.get))&&(C.get=j),(j=w(U.set))&&(C.set=j),(j=w(U.init))&&m.push(j)}else(j=w(U))&&(k==="field"?m.push(j):C[N]=j)}v&&Object.defineProperty(v,f.name,C),T=!0},u=function(a,c,l){for(var f=arguments.length>2,m=0;m<c.length;m++)l=f?c[m].call(a,l):c[m].call(a);return f?l:void 0},d=function(a){return typeof a=="symbol"?a:"".concat(a)},y=function(a,c,l){return typeof c=="symbol"&&(c=c.description?"[".concat(c.description,"]"):""),Object.defineProperty(a,"name",{configurable:!0,value:l?"".concat(l," ",c):c})},R=function(a,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(a,c)},F=function(a,c,l,f){function m(h){return h instanceof l?h:new l(function(w){w(h)})}return new(l||(l=Promise))(function(h,w){function k(C){try{v(f.next(C))}catch(j){w(j)}}function N(C){try{v(f.throw(C))}catch(j){w(j)}}function v(C){C.done?h(C.value):m(C.value).then(k,N)}v((f=f.apply(a,c||[])).next())})},p=function(a,c){var l={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},f,m,h,w;return w={next:k(0),throw:k(1),return:k(2)},typeof Symbol=="function"&&(w[Symbol.iterator]=function(){return this}),w;function k(v){return function(C){return N([v,C])}}function N(v){if(f)throw new TypeError("Generator is already executing.");for(;w&&(w=0,v[0]&&(l=0)),l;)try{if(f=1,m&&(h=v[0]&2?m.return:v[0]?m.throw||((h=m.return)&&h.call(m),0):m.next)&&!(h=h.call(m,v[1])).done)return h;switch(m=0,h&&(v=[v[0]&2,h.value]),v[0]){case 0:case 1:h=v;break;case 4:return l.label++,{value:v[1],done:!1};case 5:l.label++,m=v[1],v=[0];continue;case 7:v=l.ops.pop(),l.trys.pop();continue;default:if(h=l.trys,!(h=h.length>0&&h[h.length-1])&&(v[0]===6||v[0]===2)){l=0;continue}if(v[0]===3&&(!h||v[1]>h[0]&&v[1]<h[3])){l.label=v[1];break}if(v[0]===6&&l.label<h[1]){l.label=h[1],h=v;break}if(h&&l.label<h[2]){l.label=h[2],l.ops.push(v);break}h[2]&&l.ops.pop(),l.trys.pop();continue}v=c.call(a,l)}catch(C){v=[6,C],m=0}finally{f=h=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},_=function(a,c){for(var l in a)l!=="default"&&!Object.prototype.hasOwnProperty.call(c,l)&&Z(c,a,l)},Z=Object.create?function(a,c,l,f){f===void 0&&(f=l);var m=Object.getOwnPropertyDescriptor(c,l);(!m||("get"in m?!c.__esModule:m.writable||m.configurable))&&(m={enumerable:!0,get:function(){return c[l]}}),Object.defineProperty(a,f,m)}:function(a,c,l,f){f===void 0&&(f=l),a[f]=c[l]},P=function(a){var c=typeof Symbol=="function"&&Symbol.iterator,l=c&&a[c],f=0;if(l)return l.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&f>=a.length&&(a=void 0),{value:a&&a[f++],done:!a}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},I=function(a,c){var l=typeof Symbol=="function"&&a[Symbol.iterator];if(!l)return a;var f=l.call(a),m,h=[],w;try{for(;(c===void 0||c-- >0)&&!(m=f.next()).done;)h.push(m.value)}catch(k){w={error:k}}finally{try{m&&!m.done&&(l=f.return)&&l.call(f)}finally{if(w)throw w.error}}return h},x=function(){for(var a=[],c=0;c<arguments.length;c++)a=a.concat(I(arguments[c]));return a},O=function(){for(var a=0,c=0,l=arguments.length;c<l;c++)a+=arguments[c].length;for(var f=Array(a),m=0,c=0;c<l;c++)for(var h=arguments[c],w=0,k=h.length;w<k;w++,m++)f[m]=h[w];return f},E=function(a,c,l){if(l||arguments.length===2)for(var f=0,m=c.length,h;f<m;f++)(h||!(f in c))&&(h||(h=Array.prototype.slice.call(c,0,f)),h[f]=c[f]);return a.concat(h||Array.prototype.slice.call(c))},g=function(a){return this instanceof g?(this.v=a,this):new g(a)},L=function(a,c,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var f=l.apply(a,c||[]),m,h=[];return m={},w("next"),w("throw"),w("return"),m[Symbol.asyncIterator]=function(){return this},m;function w(T){f[T]&&(m[T]=function($){return new Promise(function(D,q){h.push([T,$,D,q])>1||k(T,$)})})}function k(T,$){try{N(f[T]($))}catch(D){j(h[0][3],D)}}function N(T){T.value instanceof g?Promise.resolve(T.value.v).then(v,C):j(h[0][2],T)}function v(T){k("next",T)}function C(T){k("throw",T)}function j(T,$){T($),h.shift(),h.length&&k(h[0][0],h[0][1])}},M=function(a){var c,l;return c={},f("next"),f("throw",function(m){throw m}),f("return"),c[Symbol.iterator]=function(){return this},c;function f(m,h){c[m]=a[m]?function(w){return(l=!l)?{value:g(a[m](w)),done:!1}:h?h(w):w}:h}},J=function(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=a[Symbol.asyncIterator],l;return c?c.call(a):(a=typeof P=="function"?P(a):a[Symbol.iterator](),l={},f("next"),f("throw"),f("return"),l[Symbol.asyncIterator]=function(){return this},l);function f(h){l[h]=a[h]&&function(w){return new Promise(function(k,N){w=a[h](w),m(k,N,w.done,w.value)})}}function m(h,w,k,N){Promise.resolve(N).then(function(v){h({value:v,done:k})},w)}},X=function(a,c){return Object.defineProperty?Object.defineProperty(a,"raw",{value:c}):a.raw=c,a};var te=Object.create?function(a,c){Object.defineProperty(a,"default",{enumerable:!0,value:c})}:function(a,c){a.default=c};ie=function(a){if(a&&a.__esModule)return a;var c={};if(a!=null)for(var l in a)l!=="default"&&Object.prototype.hasOwnProperty.call(a,l)&&Z(c,a,l);return te(c,a),c},oe=function(a){return a&&a.__esModule?a:{default:a}},Y=function(a,c,l,f){if(l==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof c=="function"?a!==c||!f:!c.has(a))throw new TypeError("Cannot read private member from an object whose class did not declare it");return l==="m"?f:l==="a"?f.call(a):f?f.value:c.get(a)},le=function(a,c,l,f,m){if(f==="m")throw new TypeError("Private method is not writable");if(f==="a"&&!m)throw new TypeError("Private accessor was defined without a setter");if(typeof c=="function"?a!==c||!m:!c.has(a))throw new TypeError("Cannot write private member to an object whose class did not declare it");return f==="a"?m.call(a,l):m?m.value=l:c.set(a,l),l},fe=function(a,c){if(c===null||typeof c!="object"&&typeof c!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof a=="function"?c===a:a.has(c)},S("__extends",t),S("__assign",r),S("__rest",n),S("__decorate",s),S("__param",i),S("__esDecorate",o),S("__runInitializers",u),S("__propKey",d),S("__setFunctionName",y),S("__metadata",R),S("__awaiter",F),S("__generator",p),S("__exportStar",_),S("__createBinding",Z),S("__values",P),S("__read",I),S("__spread",x),S("__spreadArrays",O),S("__spreadArray",E),S("__await",g),S("__asyncGenerator",L),S("__asyncDelegator",M),S("__asyncValues",J),S("__makeTemplateObject",X),S("__importStar",ie),S("__importDefault",oe),S("__classPrivateFieldGet",Y),S("__classPrivateFieldSet",le),S("__classPrivateFieldIn",fe)})})(hn);var Pe={};Object.defineProperty(Pe,"__esModule",{value:!0});var lr=he,pn=function(){function e(t){if(this._maxConcurrency=t,this._queue=[],t<=0)throw new Error("semaphore must be initialized to a positive value");this._value=t}return e.prototype.acquire=function(){var t=this,r=this.isLocked(),n=new Promise(function(s){return t._queue.push(s)});return r||this._dispatch(),n},e.prototype.runExclusive=function(t){return lr.__awaiter(this,void 0,void 0,function(){var r,n,s;return lr.__generator(this,function(i){switch(i.label){case 0:return[4,this.acquire()];case 1:r=i.sent(),n=r[0],s=r[1],i.label=2;case 2:return i.trys.push([2,,4,5]),[4,t(n)];case 3:return[2,i.sent()];case 4:return s(),[7];case 5:return[2]}})})},e.prototype.isLocked=function(){return this._value<=0},e.prototype.release=function(){if(this._maxConcurrency>1)throw new Error("this method is unavailabel on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){var t=this._currentReleaser;this._currentReleaser=void 0,t()}},e.prototype._dispatch=function(){var t=this,r=this._queue.shift();if(r){var n=!1;this._currentReleaser=function(){n||(n=!0,t._value++,t._dispatch())},r([this._value--,this._currentReleaser])}},e}();Pe.default=pn;Object.defineProperty(xt,"__esModule",{value:!0});var fr=he,mn=Pe,yn=function(){function e(){this._semaphore=new mn.default(1)}return e.prototype.acquire=function(){return fr.__awaiter(this,void 0,void 0,function(){var t,r;return fr.__generator(this,function(n){switch(n.label){case 0:return[4,this._semaphore.acquire()];case 1:return t=n.sent(),r=t[1],[2,r]}})})},e.prototype.runExclusive=function(t){return this._semaphore.runExclusive(function(){return t()})},e.prototype.isLocked=function(){return this._semaphore.isLocked()},e.prototype.release=function(){this._semaphore.release()},e}();xt.default=yn;var Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.withTimeout=void 0;var ve=he;function _n(e,t,r){var n=this;return r===void 0&&(r=new Error("timeout")),{acquire:function(){return new Promise(function(s,i){return ve.__awaiter(n,void 0,void 0,function(){var o,u,d;return ve.__generator(this,function(y){switch(y.label){case 0:return o=!1,setTimeout(function(){o=!0,i(r)},t),[4,e.acquire()];case 1:return u=y.sent(),o?(d=Array.isArray(u)?u[1]:u,d()):s(u),[2]}})})})},runExclusive:function(s){return ve.__awaiter(this,void 0,void 0,function(){var i,o;return ve.__generator(this,function(u){switch(u.label){case 0:i=function(){},u.label=1;case 1:return u.trys.push([1,,7,8]),[4,this.acquire()];case 2:return o=u.sent(),Array.isArray(o)?(i=o[1],[4,s(o[0])]):[3,4];case 3:return[2,u.sent()];case 4:return i=o,[4,s()];case 5:return[2,u.sent()];case 6:return[3,8];case 7:return i(),[7];case 8:return[2]}})})},release:function(){e.release()},isLocked:function(){return e.isLocked()}}}Fe.withTimeout=_n;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.withTimeout=e.Semaphore=e.Mutex=void 0;var t=xt;Object.defineProperty(e,"Mutex",{enumerable:!0,get:function(){return t.default}});var r=Pe;Object.defineProperty(e,"Semaphore",{enumerable:!0,get:function(){return r.default}});var n=Fe;Object.defineProperty(e,"withTimeout",{enumerable:!0,get:function(){return n.withTimeout}})})(Br);var $t={},Ce={},ye={};Object.defineProperty(ye,"__esModule",{value:!0});ye.getUniqueId=void 0;const Sr=4294967295;let Lt=Math.floor(Math.random()*Sr);function gn(){return Lt=(Lt+1)%Sr,Lt}ye.getUniqueId=gn;Object.defineProperty(Ce,"__esModule",{value:!0});Ce.createIdRemapMiddleware=void 0;const wn=ye;function vn(){return(e,t,r,n)=>{const s=e.id,i=wn.getUniqueId();e.id=i,t.id=i,r(o=>{e.id=s,t.id=s,o()})}}Ce.createIdRemapMiddleware=vn;var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.createAsyncMiddleware=void 0;function bn(e){return async(t,r,n,s)=>{let i;const o=new Promise(R=>{i=R});let u=null,d=!1;const y=async()=>{d=!0,n(R=>{u=R,i()}),await o};try{await e(t,r,y),d?(await o,u(null)):s(null)}catch(R){u?u(R):s(R)}}}Oe.createAsyncMiddleware=bn;var Le={};Object.defineProperty(Le,"__esModule",{value:!0});Le.createScaffoldMiddleware=void 0;function En(e){return(t,r,n,s)=>{const i=e[t.method];return i===void 0?n():typeof i=="function"?i(t,r,n,s):(r.result=i,s())}}Le.createScaffoldMiddleware=En;var _e={},ge={};Object.defineProperty(ge,"__esModule",{value:!0});const Rn=wr;function dr(e,t,r){try{Reflect.apply(e,t,r)}catch(n){setTimeout(()=>{throw n})}}function Bn(e){const t=e.length,r=new Array(t);for(let n=0;n<t;n+=1)r[n]=e[n];return r}let Sn=class extends Rn.EventEmitter{emit(t,...r){let n=t==="error";const s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){let o;if(r.length>0&&([o]=r),o instanceof Error)throw o;const u=new Error(`Unhandled error.${o?` (${o.message})`:""}`);throw u.context=o,u}const i=s[t];if(i===void 0)return!1;if(typeof i=="function")dr(i,this,r);else{const o=i.length,u=Bn(i);for(let d=0;d<o;d+=1)dr(u[d],this,r)}return!0}};ge.default=Sn;var kr={},K={},kn=pe;pe.default=pe;pe.stable=Cr;pe.stableStringify=Cr;var Be="[...]",Pr="[Circular]",se=[],re=[];function Fr(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function pe(e,t,r,n){typeof n>"u"&&(n=Fr()),At(e,"",0,[],void 0,0,n);var s;try{re.length===0?s=JSON.stringify(e,t,r):s=JSON.stringify(e,Or(t),r)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;se.length!==0;){var i=se.pop();i.length===4?Object.defineProperty(i[0],i[1],i[3]):i[0][i[1]]=i[2]}}return s}function ce(e,t,r,n){var s=Object.getOwnPropertyDescriptor(n,r);s.get!==void 0?s.configurable?(Object.defineProperty(n,r,{value:e}),se.push([n,r,t,s])):re.push([t,r,e]):(n[r]=e,se.push([n,r,t]))}function At(e,t,r,n,s,i,o){i+=1;var u;if(typeof e=="object"&&e!==null){for(u=0;u<n.length;u++)if(n[u]===e){ce(Pr,e,t,s);return}if(typeof o.depthLimit<"u"&&i>o.depthLimit){ce(Be,e,t,s);return}if(typeof o.edgesLimit<"u"&&r+1>o.edgesLimit){ce(Be,e,t,s);return}if(n.push(e),Array.isArray(e))for(u=0;u<e.length;u++)At(e[u],u,u,n,e,i,o);else{var d=Object.keys(e);for(u=0;u<d.length;u++){var y=d[u];At(e[y],y,u,n,e,i,o)}}n.pop()}}function Pn(e,t){return e<t?-1:e>t?1:0}function Cr(e,t,r,n){typeof n>"u"&&(n=Fr());var s=It(e,"",0,[],void 0,0,n)||e,i;try{re.length===0?i=JSON.stringify(s,t,r):i=JSON.stringify(s,Or(t),r)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;se.length!==0;){var o=se.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return i}function It(e,t,r,n,s,i,o){i+=1;var u;if(typeof e=="object"&&e!==null){for(u=0;u<n.length;u++)if(n[u]===e){ce(Pr,e,t,s);return}try{if(typeof e.toJSON=="function")return}catch{return}if(typeof o.depthLimit<"u"&&i>o.depthLimit){ce(Be,e,t,s);return}if(typeof o.edgesLimit<"u"&&r+1>o.edgesLimit){ce(Be,e,t,s);return}if(n.push(e),Array.isArray(e))for(u=0;u<e.length;u++)It(e[u],u,u,n,e,i,o);else{var d={},y=Object.keys(e).sort(Pn);for(u=0;u<y.length;u++){var R=y[u];It(e[R],R,u,n,e,i,o),d[R]=e[R]}if(typeof s<"u")se.push([s,t,e]),s[t]=d;else return d}n.pop()}}function Or(e){return e=typeof e<"u"?e:function(t,r){return r},function(t,r){if(re.length>0)for(var n=0;n<re.length;n++){var s=re[n];if(s[1]===t&&s[0]===r){r=s[2],re.splice(n,1);break}}return e.call(this,t,r)}}Object.defineProperty(K,"__esModule",{value:!0});K.EthereumProviderError=K.EthereumRpcError=void 0;const Fn=kn;class Lr extends Error{constructor(t,r,n){if(!Number.isInteger(t))throw new Error('"code" must be an integer.');if(!r||typeof r!="string")throw new Error('"message" must be a nonempty string.');super(r),this.code=t,n!==void 0&&(this.data=n)}serialize(){const t={code:this.code,message:this.message};return this.data!==void 0&&(t.data=this.data),this.stack&&(t.stack=this.stack),t}toString(){return Fn.default(this.serialize(),Ln,2)}}K.EthereumRpcError=Lr;class Cn extends Lr{constructor(t,r,n){if(!On(t))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(t,r,n)}}K.EthereumProviderError=Cn;function On(e){return Number.isInteger(e)&&e>=1e3&&e<=4999}function Ln(e,t){if(t!=="[Circular]")return t}var zt={},Q={};Object.defineProperty(Q,"__esModule",{value:!0});Q.errorValues=Q.errorCodes=void 0;Q.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}};Q.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.serializeError=e.isValidCode=e.getMessageFromCode=e.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const t=Q,r=K,n=t.errorCodes.rpc.internal,s="Unspecified error message. This is a bug, please report it.",i={code:n,message:o(n)};e.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.";function o(p,_=s){if(Number.isInteger(p)){const P=p.toString();if(F(t.errorValues,P))return t.errorValues[P].message;if(y(p))return e.JSON_RPC_SERVER_ERROR_MESSAGE}return _}e.getMessageFromCode=o;function u(p){if(!Number.isInteger(p))return!1;const _=p.toString();return!!(t.errorValues[_]||y(p))}e.isValidCode=u;function d(p,{fallbackError:_=i,shouldIncludeStack:P=!1}={}){var I,x;if(!_||!Number.isInteger(_.code)||typeof _.message!="string")throw new Error("Must provide fallback error with integer number code and string message.");if(p instanceof r.EthereumRpcError)return p.serialize();const O={};if(p&&typeof p=="object"&&!Array.isArray(p)&&F(p,"code")&&u(p.code)){const g=p;O.code=g.code,g.message&&typeof g.message=="string"?(O.message=g.message,F(g,"data")&&(O.data=g.data)):(O.message=o(O.code),O.data={originalError:R(p)})}else{O.code=_.code;const g=(I=p)===null||I===void 0?void 0:I.message;O.message=g&&typeof g=="string"?g:_.message,O.data={originalError:R(p)}}const E=(x=p)===null||x===void 0?void 0:x.stack;return P&&p&&E&&typeof E=="string"&&(O.stack=E),O}e.serializeError=d;function y(p){return p>=-32099&&p<=-32e3}function R(p){return p&&typeof p=="object"&&!Array.isArray(p)?Object.assign({},p):p}function F(p,_){return Object.prototype.hasOwnProperty.call(p,_)}})(zt);var Te={};Object.defineProperty(Te,"__esModule",{value:!0});Te.ethErrors=void 0;const Ht=K,Tr=zt,A=Q;Te.ethErrors={rpc:{parse:e=>z(A.errorCodes.rpc.parse,e),invalidRequest:e=>z(A.errorCodes.rpc.invalidRequest,e),invalidParams:e=>z(A.errorCodes.rpc.invalidParams,e),methodNotFound:e=>z(A.errorCodes.rpc.methodNotFound,e),internal:e=>z(A.errorCodes.rpc.internal,e),server:e=>{if(!e||typeof e!="object"||Array.isArray(e))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:t}=e;if(!Number.isInteger(t)||t>-32005||t<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return z(t,e)},invalidInput:e=>z(A.errorCodes.rpc.invalidInput,e),resourceNotFound:e=>z(A.errorCodes.rpc.resourceNotFound,e),resourceUnavailable:e=>z(A.errorCodes.rpc.resourceUnavailable,e),transactionRejected:e=>z(A.errorCodes.rpc.transactionRejected,e),methodNotSupported:e=>z(A.errorCodes.rpc.methodNotSupported,e),limitExceeded:e=>z(A.errorCodes.rpc.limitExceeded,e)},provider:{userRejectedRequest:e=>de(A.errorCodes.provider.userRejectedRequest,e),unauthorized:e=>de(A.errorCodes.provider.unauthorized,e),unsupportedMethod:e=>de(A.errorCodes.provider.unsupportedMethod,e),disconnected:e=>de(A.errorCodes.provider.disconnected,e),chainDisconnected:e=>de(A.errorCodes.provider.chainDisconnected,e),custom:e=>{if(!e||typeof e!="object"||Array.isArray(e))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:t,message:r,data:n}=e;if(!r||typeof r!="string")throw new Error('"message" must be a nonempty string');return new Ht.EthereumProviderError(t,r,n)}}};function z(e,t){const[r,n]=Mr(t);return new Ht.EthereumRpcError(e,r||Tr.getMessageFromCode(e),n)}function de(e,t){const[r,n]=Mr(t);return new Ht.EthereumProviderError(e,r||Tr.getMessageFromCode(e),n)}function Mr(e){if(e){if(typeof e=="string")return[e];if(typeof e=="object"&&!Array.isArray(e)){const{message:t,data:r}=e;if(t&&typeof t!="string")throw new Error("Must specify string message.");return[t||void 0,r]}}return[]}(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getMessageFromCode=e.serializeError=e.EthereumProviderError=e.EthereumRpcError=e.ethErrors=e.errorCodes=void 0;const t=K;Object.defineProperty(e,"EthereumRpcError",{enumerable:!0,get:function(){return t.EthereumRpcError}}),Object.defineProperty(e,"EthereumProviderError",{enumerable:!0,get:function(){return t.EthereumProviderError}});const r=zt;Object.defineProperty(e,"serializeError",{enumerable:!0,get:function(){return r.serializeError}}),Object.defineProperty(e,"getMessageFromCode",{enumerable:!0,get:function(){return r.getMessageFromCode}});const n=Te;Object.defineProperty(e,"ethErrors",{enumerable:!0,get:function(){return n.ethErrors}});const s=Q;Object.defineProperty(e,"errorCodes",{enumerable:!0,get:function(){return s.errorCodes}})})(kr);var Tn=W&&W.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(_e,"__esModule",{value:!0});_e.JsonRpcEngine=void 0;const Mn=Tn(ge),H=kr;class V extends Mn.default{constructor(){super(),this._middleware=[]}push(t){this._middleware.push(t)}handle(t,r){if(r&&typeof r!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(t)?r?this._handleBatch(t,r):this._handleBatch(t):r?this._handle(t,r):this._promiseHandle(t)}asMiddleware(){return async(t,r,n,s)=>{try{const[i,o,u]=await V._runAllMiddleware(t,r,this._middleware);return o?(await V._runReturnHandlers(u),s(i)):n(async d=>{try{await V._runReturnHandlers(u)}catch(y){return d(y)}return d()})}catch(i){return s(i)}}}async _handleBatch(t,r){try{const n=await Promise.all(t.map(this._promiseHandle.bind(this)));return r?r(null,n):n}catch(n){if(r)return r(n);throw n}}_promiseHandle(t){return new Promise(r=>{this._handle(t,(n,s)=>{r(s)})})}async _handle(t,r){if(!t||Array.isArray(t)||typeof t!="object"){const o=new H.EthereumRpcError(H.errorCodes.rpc.invalidRequest,`Requests must be plain objects. Received: ${typeof t}`,{request:t});return r(o,{id:void 0,jsonrpc:"2.0",error:o})}if(typeof t.method!="string"){const o=new H.EthereumRpcError(H.errorCodes.rpc.invalidRequest,`Must specify a string method. Received: ${typeof t.method}`,{request:t});return r(o,{id:t.id,jsonrpc:"2.0",error:o})}const n=Object.assign({},t),s={id:n.id,jsonrpc:n.jsonrpc};let i=null;try{await this._processRequest(n,s)}catch(o){i=o}return i&&(delete s.result,s.error||(s.error=H.serializeError(i))),r(i,s)}async _processRequest(t,r){const[n,s,i]=await V._runAllMiddleware(t,r,this._middleware);if(V._checkForCompletion(t,r,s),await V._runReturnHandlers(i),n)throw n}static async _runAllMiddleware(t,r,n){const s=[];let i=null,o=!1;for(const u of n)if([i,o]=await V._runMiddleware(t,r,u,s),o)break;return[i,o,s.reverse()]}static _runMiddleware(t,r,n,s){return new Promise(i=>{const o=d=>{const y=d||r.error;y&&(r.error=H.serializeError(y)),i([y,!0])},u=d=>{r.error?o(r.error):(d&&(typeof d!="function"&&o(new H.EthereumRpcError(H.errorCodes.rpc.internal,`JsonRpcEngine: "next" return handlers must be functions. Received "${typeof d}" for request:
${Tt(t)}`,{request:t})),s.push(d)),i([null,!1]))};try{n(t,r,u,o)}catch(d){o(d)}})}static async _runReturnHandlers(t){for(const r of t)await new Promise((n,s)=>{r(i=>i?s(i):n())})}static _checkForCompletion(t,r,n){if(!("result"in r)&&!("error"in r))throw new H.EthereumRpcError(H.errorCodes.rpc.internal,`JsonRpcEngine: Response has no error or result for request:
${Tt(t)}`,{request:t});if(!n)throw new H.EthereumRpcError(H.errorCodes.rpc.internal,`JsonRpcEngine: Nothing ended request:
${Tt(t)}`,{request:t})}}_e.JsonRpcEngine=V;function Tt(e){return JSON.stringify(e,null,2)}var Me={};Object.defineProperty(Me,"__esModule",{value:!0});Me.mergeMiddleware=void 0;const jn=_e;function An(e){const t=new jn.JsonRpcEngine;return e.forEach(r=>t.push(r)),t.asMiddleware()}Me.mergeMiddleware=An;(function(e){var t=W&&W.__createBinding||(Object.create?function(n,s,i,o){o===void 0&&(o=i),Object.defineProperty(n,o,{enumerable:!0,get:function(){return s[i]}})}:function(n,s,i,o){o===void 0&&(o=i),n[o]=s[i]}),r=W&&W.__exportStar||function(n,s){for(var i in n)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&t(s,n,i)};Object.defineProperty(e,"__esModule",{value:!0}),r(Ce,e),r(Oe,e),r(Le,e),r(ye,e),r(_e,e),r(Me,e)})($t);var Se={},In={get exports(){return Se},set exports(e){Se=e}},Nn=function(t){return(r,n,s,i)=>{const o=t[r.method];return o===void 0?s():typeof o=="function"?o(r,n,s,i):(n.result=o,i())}};(function(e){e.exports=Nn})(In);const hr=(e,t,r,n)=>function(...s){const i=t.promiseModule;return new i((o,u)=>{t.multiArgs?s.push((...y)=>{t.errorFirst?y[0]?u(y):(y.shift(),o(y)):o(y)}):t.errorFirst?s.push((y,R)=>{y?u(y):o(R)}):s.push(o),Reflect.apply(e,this===r?n:this,s)})},pr=new WeakMap;var xn=(e,t)=>{t={exclude:[/.+(?:Sync|Stream)$/],errorFirst:!0,promiseModule:Promise,...t};const r=typeof e;if(!(e!==null&&(r==="object"||r==="function")))throw new TypeError(`Expected \`input\` to be a \`Function\` or \`Object\`, got \`${e===null?"null":r}\``);const n=(o,u)=>{let d=pr.get(o);if(d||(d={},pr.set(o,d)),u in d)return d[u];const y=P=>typeof P=="string"||typeof u=="symbol"?u===P:P.test(u),R=Reflect.getOwnPropertyDescriptor(o,u),F=R===void 0||R.writable||R.configurable,_=(t.include?t.include.some(y):!t.exclude.some(y))&&F;return d[u]=_,_},s=new WeakMap,i=new Proxy(e,{apply(o,u,d){const y=s.get(o);if(y)return Reflect.apply(y,u,d);const R=t.excludeMain?o:hr(o,t,i,o);return s.set(o,R),Reflect.apply(R,u,d)},get(o,u){const d=o[u];if(!n(o,u)||d===Function.prototype[u])return d;const y=s.get(d);if(y)return y;if(typeof d=="function"){const R=hr(d,t,i,o);return s.set(d,R),R}return d}});return i};const $n=ge.default;let zn=class extends $n{constructor(){super(),this.updates=[]}async initialize(){}async update(){throw new Error("BaseFilter - no update method specified")}addResults(t){this.updates=this.updates.concat(t),t.forEach(r=>this.emit("update",r))}addInitialResults(t){}getChangesAndClear(){const t=this.updates;return this.updates=[],t}};var Dt=zn;const Hn=Dt;let Dn=class extends Hn{constructor(){super(),this.allResults=[]}async update(){throw new Error("BaseFilterWithHistory - no update method specified")}addResults(t){this.allResults=this.allResults.concat(t),super.addResults(t)}addInitialResults(t){this.allResults=this.allResults.concat(t),super.addInitialResults(t)}getAllResults(){return this.allResults}};var qn=Dn,we={minBlockRef:Un,maxBlockRef:Jn,sortBlockRefs:qt,bnToHex:Vn,blockRefIsNumber:Gn,hexToInt:ke,incrementHexInt:Wn,intToHex:jr,unsafeRandomBytes:Kn};function Un(...e){return qt(e)[0]}function Jn(...e){const t=qt(e);return t[t.length-1]}function qt(e){return e.sort((t,r)=>t==="latest"||r==="earliest"?1:r==="latest"||t==="earliest"?-1:ke(t)-ke(r))}function Vn(e){return"0x"+e.toString(16)}function Gn(e){return e&&!["earliest","latest","pending"].includes(e)}function ke(e){return e==null?e:Number.parseInt(e,16)}function Wn(e){if(e==null)return e;const t=ke(e);return jr(t+1)}function jr(e){if(e==null)return e;let t=e.toString(16);return t.length%2&&(t="0"+t),"0x"+t}function Kn(e){let t="0x";for(let r=0;r<e;r++)t+=mr(),t+=mr();return t}function mr(){return Math.floor(Math.random()*16).toString(16)}const Qn=Xr,Xn=xn,Yn=qn,{bnToHex:Hs,hexToInt:be,incrementHexInt:Zn,minBlockRef:es,blockRefIsNumber:ts}=we;let rs=class extends Yn{constructor({provider:t,params:r}){super(),this.type="log",this.ethQuery=new Qn(t),this.params=Object.assign({fromBlock:"latest",toBlock:"latest",address:void 0,topics:[]},r),this.params.address&&(Array.isArray(this.params.address)||(this.params.address=[this.params.address]),this.params.address=this.params.address.map(n=>n.toLowerCase()))}async initialize({currentBlock:t}){let r=this.params.fromBlock;["latest","pending"].includes(r)&&(r=t),r==="earliest"&&(r="0x0"),this.params.fromBlock=r;const n=es(this.params.toBlock,t),s=Object.assign({},this.params,{toBlock:n}),i=await this._fetchLogs(s);this.addInitialResults(i)}async update({oldBlock:t,newBlock:r}){const n=r;let s;t?s=Zn(t):s=r;const i=Object.assign({},this.params,{fromBlock:s,toBlock:n}),u=(await this._fetchLogs(i)).filter(d=>this.matchLog(d));this.addResults(u)}async _fetchLogs(t){return await Xn(n=>this.ethQuery.getLogs(t,n))()}matchLog(t){if(be(this.params.fromBlock)>=be(t.blockNumber)||ts(this.params.toBlock)&&be(this.params.toBlock)<=be(t.blockNumber))return!1;const r=t.address&&t.address.toLowerCase();return this.params.address&&r&&!this.params.address.includes(r)?!1:this.params.topics.every((s,i)=>{let o=t.topics[i];if(!o)return!1;o=o.toLowerCase();let u=Array.isArray(s)?s:[s];return u.includes(null)?!0:(u=u.map(R=>R.toLowerCase()),u.includes(o))})}};var ns=rs,Ut=ss;async function ss({provider:e,fromBlock:t,toBlock:r}){t||(t=r);const n=yr(t),i=yr(r)-n+1,o=Array(i).fill().map((d,y)=>n+y).map(is);return await Promise.all(o.map(d=>os(e,"eth_getBlockByNumber",[d,!1])))}function yr(e){return e==null?e:Number.parseInt(e,16)}function is(e){return e==null?e:"0x"+e.toString(16)}function os(e,t,r){return new Promise((n,s)=>{e.sendAsync({id:1,jsonrpc:"2.0",method:t,params:r},(i,o)=>{if(i)return s(i);n(o.result)})})}const as=Dt,cs=Ut,{incrementHexInt:us}=we;let ls=class extends as{constructor({provider:t,params:r}){super(),this.type="block",this.provider=t}async update({oldBlock:t,newBlock:r}){const n=r,s=us(t),o=(await cs({provider:this.provider,fromBlock:s,toBlock:n})).map(u=>u.hash);this.addResults(o)}};var fs=ls;const ds=Dt,hs=Ut,{incrementHexInt:ps}=we;let ms=class extends ds{constructor({provider:t}){super(),this.type="tx",this.provider=t}async update({oldBlock:t}){const r=t,n=ps(t),s=await hs({provider:this.provider,fromBlock:n,toBlock:r}),i=[];for(const o of s)i.push(...o.transactions);this.addResults(i)}};var ys=ms;const _s=Br.Mutex,{createAsyncMiddleware:gs}=$t,ws=Se,vs=ns,bs=fs,Es=ys,{intToHex:Ar,hexToInt:Mt}=we;var Rs=Bs;function Bs({blockTracker:e,provider:t}){let r=0,n={};const s=new _s,i=Ss({mutex:s}),o=ws({eth_newFilter:i(jt(d)),eth_newBlockFilter:i(jt(y)),eth_newPendingTransactionFilter:i(jt(R)),eth_uninstallFilter:i(Ee(_)),eth_getFilterChanges:i(Ee(F)),eth_getFilterLogs:i(Ee(p))}),u=async({oldBlock:E,newBlock:g})=>{if(n.length===0)return;const L=await s.acquire();try{await Promise.all(ae(n).map(async M=>{try{await M.update({oldBlock:E,newBlock:g})}catch(J){console.error(J)}}))}catch(M){console.error(M)}L()};return o.newLogFilter=d,o.newBlockFilter=y,o.newPendingTransactionFilter=R,o.uninstallFilter=_,o.getFilterChanges=F,o.getFilterLogs=p,o.destroy=()=>{x()},o;async function d(E){const g=new vs({provider:t,params:E});return await P(g),g}async function y(){const E=new bs({provider:t});return await P(E),E}async function R(){const E=new Es({provider:t});return await P(E),E}async function F(E){const g=Mt(E),L=n[g];if(!L)throw new Error(`No filter for index "${g}"`);return L.getChangesAndClear()}async function p(E){const g=Mt(E),L=n[g];if(!L)throw new Error(`No filter for index "${g}"`);return L.type==="log"?results=L.getAllResults():results=[],results}async function _(E){const g=Mt(E),L=n[g],M=Boolean(L);return M&&await I(g),M}async function P(E){const g=ae(n).length,L=await e.getLatestBlock();await E.initialize({currentBlock:L}),r++,n[r]=E,E.id=r,E.idHex=Ar(r);const M=ae(n).length;return O({prevFilterCount:g,newFilterCount:M}),r}async function I(E){const g=ae(n).length;delete n[E];const L=ae(n).length;O({prevFilterCount:g,newFilterCount:L})}async function x(){const E=ae(n).length;n={},O({prevFilterCount:E,newFilterCount:0})}function O({prevFilterCount:E,newFilterCount:g}){if(E===0&&g>0){e.on("sync",u);return}if(E>0&&g===0){e.removeListener("sync",u);return}}}function jt(e){return Ee(async(...t)=>{const r=await e(...t);return Ar(r.id)})}function Ee(e){return gs(async(t,r)=>{const n=await e.apply(null,t.params);r.result=n})}function Ss({mutex:e}){return t=>async(r,n,s,i)=>{(await e.acquire())(),t(r,n,s,i)}}function ae(e,t){const r=[];for(let n in e)r.push(e[n]);return r}const ks=ge.default,Ps=Se,{createAsyncMiddleware:_r}=$t,Fs=Rs,{unsafeRandomBytes:Cs,incrementHexInt:Os}=we,Ls=Ut;var Js=Ts;function Ts({blockTracker:e,provider:t}){const r={},n=Fs({blockTracker:e,provider:t});let s=!1;const i=new ks,o=Ps({eth_subscribe:_r(u),eth_unsubscribe:_r(d)});return o.destroy=R,{events:i,middleware:o};async function u(F,p){if(s)throw new Error("SubscriptionManager - attempting to use after destroying");const _=F.params[0],P=Cs(16);let I;switch(_){case"newHeads":I=x({subId:P});break;case"logs":const E=F.params[1],g=await n.newLogFilter(E);I=O({subId:P,filter:g});break;default:throw new Error(`SubscriptionManager - unsupported subscription type "${_}"`)}r[P]=I,p.result=P;return;function x({subId:E}){const g={type:_,destroy:async()=>{e.removeListener("sync",g.update)},update:async({oldBlock:L,newBlock:M})=>{const J=M,X=Os(L);(await Ls({provider:t,fromBlock:X,toBlock:J})).map(Ms).forEach(Y=>{y(E,Y)})}};return e.on("sync",g.update),g}function O({subId:E,filter:g}){return g.on("update",M=>y(E,M)),{type:_,destroy:async()=>await n.uninstallFilter(g.idHex)}}}async function d(F,p){if(s)throw new Error("SubscriptionManager - attempting to use after destroying");const _=F.params[0],P=r[_];if(!P){p.result=!1;return}delete r[_],await P.destroy(),p.result=!0}function y(F,p){i.emit("notification",{jsonrpc:"2.0",method:"eth_subscription",params:{subscription:F,result:p}})}function R(){i.removeAllListeners();for(const F in r)r[F].destroy(),delete r[F];s=!0}}function Ms(e){return{hash:e.hash,parentHash:e.parentHash,sha3Uncles:e.sha3Uncles,miner:e.miner,stateRoot:e.stateRoot,transactionsRoot:e.transactionsRoot,receiptsRoot:e.receiptsRoot,logsBloom:e.logsBloom,difficulty:e.difficulty,number:e.number,gasLimit:e.gasLimit,gasUsed:e.gasUsed,nonce:e.nonce,mixHash:e.mixHash,timestamp:e.timestamp,extraData:e.extraData}}export{ge as a,Rs as e,kn as f,As as j,Ns as p,Js as s};
//# sourceMappingURL=subscriptionManager-9489caf4.js.map
