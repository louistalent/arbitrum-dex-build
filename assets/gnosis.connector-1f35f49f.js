var g=Object.defineProperty;var p=(n,e,s)=>e in n?g(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var l=(n,e,s)=>(p(n,typeof e!="symbol"?e+"":e,s),s);import{gk as v,gl as m,gm as k,gn as _}from"./index-4a1c513c.js";var f={},c={},h={};Object.defineProperty(h,"__esModule",{value:!0});h.getLowerCase=void 0;function b(n){return n&&n.toLowerCase()}h.getLowerCase=b;Object.defineProperty(c,"__esModule",{value:!0});c.SafeAppProvider=void 0;const y=v,u=h;class w{constructor(e,s){this.submittedTxs=new Map,this.events=new y.EventEmitter,this.safe=e,this.sdk=s}async connect(){this.events.emit("connect",{chainId:this.chainId})}async disconnect(){}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}get chainId(){return this.safe.chainId}async request(e){const{method:s,params:t=[]}=e;switch(s){case"eth_accounts":return[this.safe.safeAddress];case"net_version":case"eth_chainId":return`0x${this.chainId.toString(16)}`;case"eth_sendTransaction":const r=Object.assign({value:"0",data:"0x"},t[0]),d=await this.sdk.txs.send({txs:[r]});return this.submittedTxs.set(d.safeTxHash,{from:this.safe.safeAddress,hash:d.safeTxHash,gas:0,gasPrice:"0x00",nonce:0,input:r.data,value:r.value,to:r.to,blockHash:null,blockNumber:null,transactionIndex:null}),d.safeTxHash;case"eth_blockNumber":return(await this.sdk.eth.getBlockByNumber(["latest"])).number;case"eth_getBalance":return this.sdk.eth.getBalance([u.getLowerCase(t[0]),t[1]]);case"eth_getCode":return this.sdk.eth.getCode([u.getLowerCase(t[0]),t[1]]);case"eth_getStorageAt":return this.sdk.eth.getStorageAt([u.getLowerCase(t[0]),t[1],t[2]]);case"eth_getBlockByNumber":return this.sdk.eth.getBlockByNumber([t[0],t[1]]);case"eth_getBlockByHash":return this.sdk.eth.getBlockByHash([t[0],t[1]]);case"eth_getTransactionByHash":let i=t[0];try{i=(await this.sdk.txs.getBySafeTxHash(i)).txHash||i}catch{}return this.submittedTxs.has(i)?this.submittedTxs.get(i):this.sdk.eth.getTransactionByHash([i]).then(a=>(a&&(a.hash=t[0]),a));case"eth_getTransactionReceipt":{let a=t[0];try{a=(await this.sdk.txs.getBySafeTxHash(a)).txHash||a}catch{}return this.sdk.eth.getTransactionReceipt([a]).then(o=>(o&&(o.transactionHash=t[0]),o))}case"eth_estimateGas":return 0;case"eth_call":return this.sdk.eth.call([t[0],t[1]]);case"eth_getLogs":return this.sdk.eth.getPastLogs([t[0]]);default:throw Error(`"${e.method}" not implemented`)}}send(e,s){e||s("Undefined request"),this.request(e).then(t=>s(null,{jsonrpc:"2.0",id:e.id,result:t})).catch(t=>s(t,null))}}c.SafeAppProvider=w;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.SafeAppProvider=void 0;var e=c;Object.defineProperty(n,"SafeAppProvider",{enumerable:!0,get:function(){return e.SafeAppProvider}})})(f);class C extends m{constructor(){super(...arguments);l(this,"id",k.Gnosis)}async connect(){const s=new _,t=await s.safe.getInfo(),r=new f.SafeAppProvider(t,s);return r?(this.provider=r,this.active.value=!0,this.handleChainChanged(t.chainId),this.handleAccountsChanged([t.safeAddress])):console.error("Tried to connect to Gnosis Safe but it was not detected. Please install make sure you are using the Gnosis interface."),{provider:r,account:this.account,chainId:this.chainId}}}export{C as SafeConnector};
//# sourceMappingURL=gnosis.connector-1f35f49f.js.map
