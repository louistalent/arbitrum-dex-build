var eo=Object.defineProperty;var to=(a,t,o)=>t in a?eo(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;var Le=(a,t,o)=>(to(a,typeof t!="symbol"?t+"":t,o),o);import{_ as Be}from"./BalLoadingBlock.vue_vue_type_style_index_0_lang-3fa460ee.js";import{u as oo,d as no,a as Ge,T as ze,b as so}from"./usePoolTransfersGuard-b0534fb4.js";import{as as Oe,e as Ne,bj as it,ak as be,s as l,G as M,aT as ao,b as le,a as Qe,u as ue,c as s,aH as se,l as rt,by as ne,bP as ct,bQ as ut,bg as We,d as K,x as dt,o as he,aE as ye,t as v,B as q,D as R,v as e,H as L,a1 as oe,a4 as lo,U as F,a0 as xe,C as S,a6 as $e,a9 as io,_ as pt,bR as ot,y as Q,z as N,bS as Ye,bT as ro,bU as mt,bV as He,bW as De,bX as co,bY as nt,ax as vt,P as uo,aa as po,bZ as Ue,b_ as st,b$ as mo,aS as Fe,c0 as vo,f as fo,Q as ho,p as ge,c1 as ft,c2 as go,aO as ko,Z as _e,$ as Ze,aV as ht,c3 as Pe,c4 as _o,c5 as yo,c6 as bo,c7 as gt,aW as kt,c8 as _t,av as wo,j as yt,am as To,a8 as Me,F as fe,ah as Ee,ag as bt,af as wt,az as Ke,O as So,c9 as Tt,ay as St,aL as Ao,aM as Io,a7 as qe,aC as At,ca as Po,aw as xo,cb as Bo,ba as $o,a2 as It,aD as Xe,aF as Pt,J as Mo,cc as Co,cd as xt,ce as Bt,bH as Lo,cf as Wo,bq as Eo}from"./index-4a1c513c.js";import{_ as Oo}from"./BalAssetSet-1d81bc3d.js";import{u as No}from"./useSwapState-8cdb4cec.js";import{u as Fo,R as at,a as qo}from"./useRelayerApprovalTx-95afc1c6.js";import{H as $t,R as Mt,u as Vo,L as Ct}from"./poolLiquidity-de5c7424.js";import{o as Jo,a as Lt}from"./validations-f14f6fca.js";import{v as jo,b as Ro}from"./swapper-7147db03.js";import{u as Wt}from"./useTokenApprovalActions-8e0c610b.js";import{_ as zo}from"./BalAccordion.vue_vue_type_script_setup_true_lang-b50b54c6.js";import{_ as Ho}from"./BalTabs.vue_vue_type_style_index_0_lang-df57e740.js";import{_ as Et}from"./BalCheckbox-b97e4661.js";import{_ as Ce}from"./useTransactionErrors-09c4ac25.js";import{_ as Ot}from"./StakePreviewModal.vue_vue_type_script_setup_true_lang-225d7685.js";import{_ as Nt}from"./TokenInput.vue_vue_type_script_setup_true_lang-d6685049.js";import{_ as Ft}from"./BalCircle-e6fd1d55.js";import{u as qt,_ as Vt,p as Do}from"./pool-staking.provider-fee39c11.js";import{_ as Jt}from"./BalActionSteps.vue_vue_type_script_setup_true_lang-78b4efb6.js";import{_ as jt}from"./ConfirmationIndicator.vue_vue_type_script_setup_true_lang-5746d56d.js";import{E as Rt,u as Uo,C as Go}from"./exchange.service-4f09193f.js";import{_ as Qo,a as Yo}from"./BalDataListRow.vue_vue_type_script_setup_true_lang-03b32597.js";import{S as Zo,_ as Ko}from"./SwapSettingsPopover.vue_vue_type_style_index_0_lang-1d919268.js";import"./BalAsset-fe687731.js";import"./usePoolQuery-b97c571a.js";import"./useQueryHelpers-8cb4e6d7.js";import"./numeral-7364357d.js";import"./tslib.es6-b45817b3.js";const zt=Ne({amounts:[],tokenAddresses:[],propAmounts:[],validInputs:[],highPriceImpactAccepted:!1,submitting:!1,sorReady:!1}),Xo=it().sor;function en(){zt.amounts=[]}function et(){return{...Oe(zt),sor:Xo,resetAmounts:en}}const tn={},on={class:"my-wallet-subheader"};function nn(a,t){return l(),M("div",on,[ao(a.$slots,"default",{},void 0,!0)])}const lt=be(tn,[["render",nn],["__scopeId","data-v-b23fa483"]]);function Ht(){const{hasBalance:a,nativeAsset:t,balanceFor:o}=le(),n=Qe.network.nativeAsset.symbol,{appNetworkConfig:i,isWalletReady:m}=ue(),r=s(()=>m.value?Number(o(i.nativeAsset.address)).toFixed(4):"-");return{hasNativeBalance:s(()=>a(t.address)),nativeBalance:r,nativeCurrency:n}}function Dt({excludedTokens:a=[],pool:t,includeNativeAsset:o=!1}){const{appNetworkConfig:n}=ue(),{balances:i,balanceQueryLoading:m,nativeAsset:r}=le(),d=s(()=>t),{isWethPool:c,isDeepPool:p}=se(d);function b(f){return a.some(I=>ne(I,f))}const h=s(()=>rt.take(Object.keys(i.value).filter(f=>{const I=o?!0:!ne(f,n.nativeAsset.address);return Number(i.value[f])>0&&I&&!ne(f,n.addresses.veBAL)&&!b(f)}),21)),w=s(()=>{if(p.value&&(t!=null&&t.tokens)){const I=ct(t.tokens);return ut(t.address,I)}const f=(t==null?void 0:t.tokensList)||[];return c.value?[r.address,...f]:f}),W=s(()=>h.value.filter(f=>We(w.value,f))),g=s(()=>w.value.filter(f=>!We(h.value,f))||[]),C=s(()=>w.value.length?h.value.filter(f=>!We(w.value,f))||[]:h.value);return{isLoadingBalances:m,tokensWithBalance:h,poolTokenAddresses:w,poolTokensWithBalance:W,poolTokensWithoutBalance:g,notPoolTokensWithBalance:C}}const sn={class:"flex flex-col w-full h-full bg-transparent"},an={key:0,class:"flex lg:justify-between p-3 pb-0 lg:pb-3 lg:border-b dark:border-gray-900"},ln={key:0,class:"ml-1 lg:ml-0 font-semibold lg:font-normal"},rn={key:0,class:"mr-0.5 text-red-500 hover:text-red-700 dark:hover:text-red-400 transition-colors"},cn={key:1},un={class:"z-0 px-3 pb-3 h-full my-wallet"},dn={key:1},pn={class:"mt-5"},mn={key:1,class:"mt-3"},vn={key:2,class:"text-sm opacity-0 text-secondary fade-in"},fn={key:2,class:"flex mt-4 w-full font-medium"},hn=K({__name:"MyWallet",props:{excludedTokens:{default:()=>[]},pool:{default:void 0},includeNativeAsset:{type:Boolean,default:!1}},emits:["click:asset"],setup(a,{emit:t}){const o=a,{isWalletReady:n,startConnectWithInjectedProvider:i}=ue(),{upToLargeBreakpoint:m}=dt(),{setTokenInAddress:r}=No(),d=Qe.network.name,{t:c}=he(),{isDeepPool:p,isPreMintedBptPool:b}=se(ye(o,"pool")),{tokensWithBalance:h,poolTokenAddresses:w,poolTokensWithBalance:W,poolTokensWithoutBalance:g,notPoolTokensWithBalance:C,isLoadingBalances:f}=Dt(o),I=s(()=>c("noNativeCurrency",[P,d])),V=s(()=>c("noNativeCurrencyEthereum",[P,d])),k=s(()=>c("noTokensInWallet",[d])),{hasNativeBalance:A,nativeBalance:u,nativeCurrency:P}=Ht();function z(H){r(H);const D=We(w.value,H);t("click:asset",H,D)}return(H,D)=>{const X=$e,Y=Be,O=Oo,x=io,B=pt;return l(),v(B,{square:e(m),noPad:"",noBorder:e(m),growContent:"",hFull:e(m),shadow:"none"},{default:q(()=>[R("div",sn,[e(m)?F("",!0):(l(),M("div",an,[R("h6",null,L(H.$t("myWallet2")),1),e(f)?(l(),v(Y,{key:1,class:"w-12 h-8"})):(l(),M("div",ln,[e(A)?(l(),M("div",cn,L(e(u))+" "+L(e(P)),1)):(l(),M("div",rn,[oe(L(e(u))+" "+L(e(P))+" ",1),e(n)?(l(),v(X,{key:0,text:e(lo)?e(V):e(I),iconSize:"sm",iconName:"alert-triangle",iconClass:"text-red-500 hover:text-red-700 dark:hover:text-red-400 transition-colors",width:"72",class:"relative top-0.5"},null,8,["text"])):F("",!0)]))]))])),R("div",un,[e(f)?(l(),v(Y,{key:0,class:"h-8"})):e(n)?(l(),M("div",dn,[a.pool?(l(),M(xe,{key:0},[e(p)?(l(),v(lt,{key:0,class:"text-sm border-b text-secondary"},{default:q(()=>[oe(L(e(c)("myWalletCard.title.poolTokens")),1)]),_:1})):F("",!0),R("div",pn,[S(O,{balAssetProps:{button:!0},width:275,wrap:"",size:30,addresses:[...e(W),...e(g)],disabledAddresses:e(g),maxAssetsPerLine:7,onClick:z},null,8,["addresses","disabledAddresses"])]),e(p)&&e(b)&&e(C).length?(l(),M(xe,{key:1},[S(lt,{class:"my-5 text-sm border-t border-b text-secondary"},{default:q(()=>[oe(L(e(c)("myWalletCard.title.otherTokens")),1)]),_:1}),S(O,{balAssetProps:{button:!0},width:275,wrap:"",size:30,addresses:e(C),maxAssetsPerLine:7,onClick:z},null,8,["addresses"])],64)):F("",!0)],64)):(l(),M("div",mn,[S(O,{balAssetProps:{button:!0},width:275,wrap:"",size:30,addresses:e(h),maxAssetsPerLine:7,onClick:z},null,8,["addresses"])])),e(h).length===0?(l(),M("p",vn,L(e(k))+". ",1)):F("",!0)])):(l(),M("div",fn,[S(x,{onClick:e(i)},{default:q(()=>[oe(L(e(c)("connectYourWallet")),1)]),_:1},8,["onClick"])]))])])]),_:1},8,["square","noBorder","hFull"])}}});var tt=(a=>(a[a.PoolTokens=0]="PoolTokens",a[a.SingleToken=1]="SingleToken",a))(tt||{});const Ve=[{value:0,label:ot.global.t("investment.tabs.poolTokens")},{value:1,label:ot.global.t("investment.tabs.singleToken")}],Ut=Q(Ve[0].value);function gn(){Ut.value=Ve[0].value}function Gt(){return{activeTab:Ut,resetTabs:gn}}class kn{constructor(t,o,n){Le(this,"lastSwapRoute");this.pool=t,this.sdk=o,this.gasPriceService=n}async join(t){const{signer:o,slippageBsp:n}=t,i=await o.getAddress();if(await this.queryJoin(t),!this.lastSwapRoute)throw new Error("Could not fetch swap route for join.");const m=this.getSwapAttributes(this.lastSwapRoute,n,i),r=this.getSwapOptions(t.amountsIn[0]),{kind:d,swaps:c,assets:p,funds:b,limits:h}=m.attributes;return jo.batchSwap(d,c,p,b,h,t.transactionDeadline,r)}async queryJoin({amountsIn:t,tokensIn:o,signer:n}){var h;if(t.length===0)throw new Error("Missing amounts to join with.");const i=t[0],m=o[i.address];if(!m)throw new Error("Missing critical token metadata.");if(!i.value||N(i.value).eq(0))return{bptOut:"0",priceImpact:0};Ye.value||await ro();const r=Jo(i.value,m.decimals),d=mt(r,m.decimals),c=await this.getGasPrice(n);this.lastSwapRoute=await this.sdk.swaps.findRouteGivenIn({tokenIn:this.formatAddressForSor(i.address),tokenOut:this.pool.value.address,amount:d,gasPrice:c,maxPools:4});const p=He(this.lastSwapRoute.returnAmount,((h=this.pool.value.onchain)==null?void 0:h.decimals)||18);if(N(p).eq(0))throw new Error("Not enough liquidity.");const b=this.calcPriceImpact(i.value,p,this.lastSwapRoute.marketSp);return{bptOut:p,priceImpact:b}}calcPriceImpact(t,o,n){const m=N(t).div(o).div(n).minus(1)||1;return Math.max(0,m.toNumber())}async getGasPrice(t){let o;const n=await this.gasPriceService.getGasPrice();if(n?o=n.price:o=(await t.getGasPrice()).toNumber(),!o)throw new Error("Failed to fetch gas price.");return De.from(o)}getSwapAttributes(t,o,n){const i=De.from(co(60));return this.sdk.swaps.buildSwap({userAddress:n,swapInfo:t,kind:0,deadline:i,maxSlippage:o})}getSwapOptions(t){const o={};return ne(t.address,nt)&&(o.value=vt(t.value).toString()),o}formatAddressForSor(t){return ne(t,nt)?uo.ZeroAddress:t}}class _n{constructor(t,o,n){Le(this,"lastJoinRes");this.pool=t,this.sdk=o,this.gasPriceService=n}async join(t){if(await this.queryJoin(t),!this.lastJoinRes)throw new Error("Could not query generalised join");const o=new po(t.signer),{to:n,encodedCall:i}=this.lastJoinRes;return o.raw.sendTransaction({to:n,data:i})}async queryJoin({amountsIn:t,tokensIn:o,signer:n,slippageBsp:i,relayerSignature:m,approvalActions:r}){var f;const d=t.map(({address:I,value:V})=>{const k=Ue(o,I);if(!k||!k.decimals)throw new Error(`Token metadata missing for: ${I}`);return mt(V||"0",k.decimals).toString()}),c=t.map(({address:I})=>I),p=await n.getAddress(),b=i.toString(),h=this.pool.value.id,W=!t.some(I=>!I.valid)&&!r.length?st.Static:st.VaultModel;if(console.log({simulationType:W}),this.lastJoinRes=await this.sdk.pools.generalisedJoin(h,c,d,p,b,n,W,m),!this.lastJoinRes)throw new Error("Failed to fetch expected output.");const g=He(this.lastJoinRes.expectedOut,((f=this.pool.value.onchain)==null?void 0:f.decimals)||18),C=N(He(this.lastJoinRes.priceImpact,18)).toNumber();if(N(g).eq(0))throw new Error("Not enough liquidity.");return{bptOut:g,priceImpact:C}}}class yn{constructor(t,o=it(),n=mo){Le(this,"joinHandler");this.pool=t,this.sdk=o,this.gasPriceServ=n,this.joinHandler=this.setJoinHandler()}setJoinHandler(t=!1){const{pool:o,sdk:n,gasPriceServ:i}=this;if(t)return this.joinHandler=new kn(o,n,i);if(Fe(o.value))return this.joinHandler=new _n(o,n,i);throw new Error(`Pool type not handled: ${o.value.poolType}`)}async join(t){return this.joinHandler.join(t)}async queryJoin(t){return this.joinHandler.queryJoin(t)}}const bn=a=>{const t=Q(!1),o=Q([]),n=Q("0"),i=Q(0),m=Q(!1),r=Q(""),d=Q([]),c=Q(!1),p=no(Je,1e3),b=s(()=>t.value&&!P.value),h=fo(ho.Pools.Joins.QueryJoin(o,Ye,c),p,Ne({enabled:b,refetchOnWindowFocus:!1})),w=new yn(a),{getTokens:W,prices:g,injectTokens:C,priceFor:f}=le(),{toFiat:I}=ge(),{slippageBsp:V}=ft(),{getSigner:k}=ue(),{transactionDeadline:A}=bo(),{txState:u,txInProgress:P,resetTxState:z}=oo(),H=Fo(at.BATCH_V4),{relayerSignature:D,relayerApprovalAction:X}=qo(at.BATCH_V4),Y=s(()=>Fe(a.value)),O=s(()=>{let _=[];return _=Y.value?ct(a.value.tokens):a.value.tokensList,ut(a.value.address,_)}),x=s(()=>W(o.value.map(_=>_.address))),B=s(()=>N(i.value).isGreaterThanOrEqualTo($t)),T=s(()=>N(i.value).isGreaterThanOrEqualTo(Mt)),E=s(()=>B.value?m.value:!0),J=s(()=>o.value.every(_=>_.valid===!0)&&E.value),ae=s(()=>o.value.some(_=>N(_.value).gt(0))),G=s(()=>o.value.filter(_=>N(_.value).gt(0))),de=s(()=>!G.value.every(_=>N(f(_.address)).gt(0))),ke=s(()=>{const _=o.value.map(ve=>I(ve.value||0,ve.address));return go(_).toString()}),Te=s(()=>ko(a.value,n.value)),Se=s(()=>Y.value&&!c.value&&!(H.isUnlocked.value||D.value)),Ae=s(()=>o.value.map(_=>_.address)),pe=s(()=>o.value.map(_=>_.value)),{getTokenApprovalActions:$}=Wt(Ae,pe),j=s(()=>h.isFetching.value),ie=s(()=>{var _;return(_=h.error.value)==null?void 0:_.message});function re(_){o.value=_}function me(_){_.forEach(ve=>o.value.push({address:ve,value:"",valid:!0}))}function ce(){o.value.forEach((_,ve)=>{o.value[ve].value=""})}function Z(){n.value="0",i.value=0,h.remove()}function ee(){const _=$();d.value=Se.value?[X.value,..._]:_}async function Je(){if(!ae.value)return i.value=0,null;try{w.setJoinHandler(c.value),ee();const _=await w.queryJoin({amountsIn:G.value,tokensIn:x.value,prices:g.value,signer:k(),slippageBsp:V.value,relayerSignature:D.value,approvalActions:d.value,transactionDeadline:A});return n.value=_.bptOut,i.value=_.priceImpact,_}catch(_){throw gt(_),new Error("Failed to construct join.",{cause:_})}}async function je(){try{return r.value="",w.setJoinHandler(c.value),ee(),w.join({amountsIn:G.value,tokensIn:x.value,prices:g.value,signer:k(),slippageBsp:V.value,relayerSignature:D.value,approvalActions:d.value,transactionDeadline:A})}catch(_){throw r.value=_.message,new Error("Failed to submit join transaction.",{cause:_})}}function Re(_){c.value=_}return _e(c,_=>{Z(),w.setJoinHandler(_)}),Ze(()=>{C(O.value)}),ht(()=>t.value=!0),{amountsIn:o,highPriceImpactAccepted:m,txState:u,pool:Pe(a),isSingleAssetJoin:Pe(c),bptOut:Pe(n),priceImpact:Pe(i),txError:Pe(r),isLoadingQuery:j,queryError:ie,joinTokens:O,highPriceImpact:B,rektPriceImpact:T,hasAcceptedHighPriceImpact:E,hasValidInputs:J,hasAmountsIn:ae,fiatValueIn:ke,fiatValueOut:Te,txInProgress:P,approvalActions:d,missingPricesIn:de,setAmountsIn:re,addTokensIn:me,resetAmounts:ce,join:je,resetTxState:z,setIsSingleAssetJoin:Re,queryJoinQuery:h}},Qt=Symbol(_o.Providers.JoinPool);function wn(a){const t=Fe(a.value)?bn(a):{};return yo(Qt,t),t}const we=()=>vo(Qt),Yt=K({__name:"InvestPageMyWallet",props:{pool:null},setup(a){const t=a,o=s(()=>t.pool),n=s(()=>{var k;return(k=o.value)!=null&&k.address?[o.value.address]:[]}),{useNativeAsset:i}=Ge(),{isWethPool:m,isDeepPool:r}=se(o),{tokenAddresses:d,amounts:c}=et(),{setAmountsIn:p,isSingleAssetJoin:b,amountsIn:h}=we(),{nativeAsset:w,wrappedNativeAsset:W,getMaxBalanceFor:g}=le(),{activeTab:C}=Gt();function f(k,A){if(b.value)p([{address:k,value:A,valid:!0}]);else{const u=h.value.find(P=>ne(k,P.address));u&&(u.address=k,u.valid=!0,u.value=A)}}function I(k,A){const u=_t(d.value,k);u>=0&&(c.value[u]=A)}function V(k,A){var P;const u=g(k);if(r.value)A?f(k,u):(C.value=Ve[tt.SingleToken].value,kt(()=>{f(k,u)}));else if(m.value){const z=ne(k,w.address),H=ne(k,(P=W.value)==null?void 0:P.address);(z||H)&&(i.value=z),setTimeout(()=>{I(k,u)},50)}else I(k,u)}return(k,A)=>(l(),v(hn,{includeNativeAsset:"",excludedTokens:e(n),pool:e(o),"onClick:asset":V},null,8,["excludedTokens","pool"]))}}),Tn=K({__name:"InvestPageAccordion",props:{pool:null},setup(a){const t=a,o=s(()=>t.pool),{hasNativeBalance:n,nativeBalance:i,nativeCurrency:m}=Ht(),{t:r}=he(),{isDeepPool:d}=se(o),c=s(()=>n?`${i.value} ${m}`:""),p=s(()=>d.value?`${r("myWallet2")} ${c.value}`:r("poolTransfer.myWalletTokensCard.title"));return(b,h)=>(l(),v(zo,{sections:[{title:e(p),id:"myWalletTokens"}]},{myWalletTokens:q(()=>[S(Yt,{pool:e(o)},null,8,["pool"])]),_:1},8,["sections"]))}}),Sn={key:0,class:"flex items-center mb-4"},An=["innerHTML"],Zt=K({__name:"WrapStEthLink",props:{pool:null},setup(a){const t=a,{isMainnetWstETHPool:o}=se(ye(t,"pool")),{networkConfig:n}=wo(),{getToken:i}=le(),{networkSlug:m}=yt(),r=s(()=>i(n.addresses.stETH)),d=s(()=>i(n.addresses.wstETH));return(c,p)=>{const b=To("router-link"),h=Me,w=$e;return e(o)?(l(),M("div",Sn,[S(b,{to:{name:"swap",params:{networkSlug:e(m),assetIn:e(r).address,assetOut:e(d).address}},class:"text-xs underline text-secondary"},{default:q(()=>[oe(L(c.$t("wrapInstruction",[e(r).symbol,e(d).symbol])),1)]),_:1},8,["to"]),S(w,null,{activator:q(()=>[S(h,{name:"info",size:"xs",class:"ml-2 text-gray-400 dark:text-gray-500"})]),default:q(()=>[R("div",{innerHTML:c.$t("wrapStEthTooltip")},null,8,An)]),_:1})])):F("",!0)}}}),In={class:"data-table"},Pn={class:"data-table-row total-row"},xn={class:"p-2"},Bn={class:"data-table-number-col"},$n={key:0,class:"text-sm"},Mn={key:0,class:"text-gray-400 dark:text-gray-600"},Cn={class:"p-2"},Ln={class:"data-table-number-col"},Wn={class:"flex"},En={key:0},On={key:0,class:"text-sm font-semibold"},Nn={key:0,class:"text-gray-400 dark:text-gray-600"},Fn=K({__name:"InvestFormTotals",props:{math:null},emits:["maximize","optimize"],setup(a,{emit:t}){const o=a,{fNum:n}=ge(),{isWalletReady:i}=ue(),{fiatTotal:m,hasNoBalances:r,hasAllTokens:d,priceImpact:c,highPriceImpact:p,maximized:b,optimized:h,loadingData:w,supportsPropotionalOptimization:W}=Oe(Ne(o.math)),g=s(()=>({"dark:bg-gray-800":!p.value,"bg-red-500 dark:bg-red-500 text-white divide-red-400":p.value})),C=s(()=>({"text-gradient":!p.value,"text-red-500 px-2 py-1 bg-white rounded-lg":p.value}));return(f,I)=>{const V=Be,k=Me,A=$e;return l(),M("div",In,[R("div",Pn,[R("div",xn,L(f.$t("total")),1),R("div",Bn,[oe(L(e(n)(e(m),e(fe).fiat))+" ",1),e(i)&&!e(r)?(l(),M("div",$n,[e(b)?(l(),M("span",Mn,L(f.$t("maxed")),1)):(l(),M("span",{key:1,class:"text-blue-500 cursor-pointer",onClick:I[0]||(I[0]=u=>t("maximize"))},L(f.$t("max")),1))])):F("",!0)])]),R("div",{class:Ee(["data-table-row price-impact-row",e(g)])},[R("div",Cn,L(f.$t("priceImpact")),1),R("div",Ln,[R("div",Wn,[e(w)?(l(),v(V,{key:1,class:"w-10"})):(l(),M("span",En,L(e(n)(e(c),e(fe).percent)),1)),S(A,{text:f.$t("customAmountsTip")},{activator:q(()=>[e(p)?(l(),v(k,{key:0,name:"alert-triangle",size:"xs",class:"-mb-px ml-1"})):(l(),v(k,{key:1,name:"info",size:"xs",class:"-mb-px ml-1 text-gray-400"}))]),_:1},8,["text"])]),e(i)&&e(d)&&e(W)?(l(),M("div",On,[e(h)?(l(),M("span",Nn,L(f.$t("optimized")),1)):(l(),M("div",{key:1,class:Ee(["cursor-pointer",e(C)]),onClick:I[1]||(I[1]=u=>t("optimize"))},L(f.$t("optimize")),3))])):F("",!0)])],2)])}}});const qn=be(Fn,[["__scopeId","data-v-a2ea827b"]]),Vn={key:1},Jn=K({__name:"InvestActions",props:{pool:null,math:null,tokenAddresses:null,disabled:{type:Boolean}},emits:["success","showStakeModal"],setup(a,{emit:t}){const o=a,n=Ne({init:!1,confirming:!1,confirmed:!1,confirmedAt:""}),{t:i}=he(),{getSigner:m,blockNumber:r}=ue(),{addTransaction:d}=bt(),{txListener:c,getTxConfirmedAt:p}=wt(),{lockablePoolId:b}=Ke(),{isStakablePool:h}=qt(),{networkSlug:w}=yt(),{refetchBalances:W}=le(),{poolWeightsLabel:g}=se(ye(o,"pool")),C=s(()=>o.tokenAddresses),{fullAmounts:f,batchSwapAmountMap:I,bptOut:V,fiatTotalLabel:k,fiatTotal:A,batchSwap:u,shouldFetchBatchSwap:P}=Oe(o.math),{tokenApprovalActions:z}=Wt(C,f),H=new Rt(ye(o,"pool")),D=s(()=>[...z,{label:i("addLiquidity"),loadingLabel:i("investment.preview.loadingLabel.investment"),confirmingLabel:i("confirming"),action:x,stepTooltip:i("investmentTooltip")}]),X=s(()=>n.init||n.confirming||n.confirmed),Y=s(()=>{var B,T;return So(V.value,((T=(B=o.pool)==null?void 0:B.onchain)==null?void 0:T.decimals)||18)});async function O(B){d({id:B.hash,type:"tx",action:"invest",summary:i("transactionSummary.investInPool",[k.value,g(o.pool)]),details:{total:k.value,pool:o.pool}}),await c(B,{onTxConfirmed:async T=>{t("success",T),n.receipt=T;const E=await p(T);n.confirmedAt=St(E),n.confirmed=!0,n.confirming=!1,Ao(Io.LiquidityAdded,N(A.value).times(100).toNumber()||0),await W()},onTxFailed:()=>{console.error("Add liquidity failed"),n.confirming=!1}})}async function x(){try{let B;return n.init=!0,u.value?B=await Ro(u.value.swaps,u.value.assets,o.pool.address,I.value,De.from(V.value)):B=await H.join(m(),f.value,o.tokenAddresses,Y.value),n.init=!1,n.confirming=!0,console.log("Receipt",B),O(B),B}catch(B){throw console.error(B),new Error("Failed to submit transaction.",{cause:B})}}return _e(r,async()=>{P.value&&!X.value&&await o.math.getBatchSwap()}),(B,T)=>{const E=Vt,J=qe;return l(),v(Tt,null,{default:q(()=>[!n.confirmed||!n.receipt?(l(),v(Jt,{key:0,actions:e(D),disabled:a.disabled},null,8,["actions","disabled"])):(l(),M("div",Vn,[S(jt,{txReceipt:n.receipt},null,8,["txReceipt"]),e(b)===a.pool.id?(l(),v(J,{key:0,tag:"router-link",to:{name:"get-vebal",params:{networkSlug:e(w)}},color:"gradient",block:"",class:"flex mt-2"},{default:q(()=>[S(E,{class:"mr-2 h-5 text-orange-300"}),oe(L(B.$t("lockToGetVeBAL")),1)]),_:1},8,["to"])):e(h)?(l(),v(J,{key:1,color:"gradient",block:"",class:"flex mt-2",onClick:T[0]||(T[0]=ae=>t("showStakeModal"))},{default:q(()=>[S(E,{class:"mr-2 h-5 text-orange-300"}),oe(L(B.$t("stakeToGetExtra")),1)]),_:1})):F("",!0),S(J,{tag:"router-link",to:{name:"pool",params:{networkSlug:e(w),id:a.pool.id}},color:"gray",outline:"",block:"",class:"mt-2"},{default:q(()=>[oe(L(B.$t("returnToPool")),1)]),_:1},8,["to"])]))]),_:1})}}}),Kt=K({__name:"InvestSummary",props:{pool:null,fiatTotal:null,priceImpact:null,isLoadingPriceImpact:{type:Boolean,default:!1},highPriceImpact:{type:Boolean,default:!1},summaryTitle:{default:void 0}},setup(a){const{fNum:t}=ge(),{currency:o}=ft();return(n,i)=>{const m=$e,r=Qo,d=Be,c=Yo;return l(),v(c,{title:n.$t("summary")},{default:q(()=>[S(r,{label:n.$t("investment.preview.summary.total")},{value:q(()=>[oe(L(e(t)(a.fiatTotal,e(fe).fiat))+" ",1),S(m,{text:n.$t("tooltips.addLiquidity.total",[e(o).toUpperCase()]),iconSize:"sm",class:"ml-2"},null,8,["text"])]),_:1},8,["label"]),S(r,{label:n.$t("priceImpact"),class:Ee({"bg-red-50 dark:bg-red-500 text-red-500 dark:text-white":a.highPriceImpact})},{value:q(()=>[a.isLoadingPriceImpact?(l(),v(d,{key:0,class:"w-10 h-6"})):(l(),M(xe,{key:1},[oe(L(e(t)(a.priceImpact,e(fe).percent))+" ",1),S(m,{text:n.$t("tooltips.addLiquidity.priceImpact"),iconSize:"sm",iconName:a.highPriceImpact?"alert-triangle":"info",iconClass:a.highPriceImpact?"text-red-500 dark:text-white":"text-gray-300",width:"72",class:"ml-2"},null,8,["text","iconName","iconClass"])],64))]),_:1},8,["label","class"])]),_:1},8,["title"])}}}),jn={class:"flex items-center"},Rn=K({__name:"InvestPreviewModal",props:{pool:null,math:null,tokenAddresses:null},emits:["close","showStakeModal"],setup(a,{emit:t}){const o=a,n=Q(!1),{t:i}=he(),{getToken:m}=le(),{toFiat:r}=ge(),{fullAmounts:d,priceImpact:c,highPriceImpact:p,rektPriceImpact:b}=Oe(o.math),{resetAmounts:h}=et(),{account:w}=ue(),W=s(()=>n.value?i("investment.preview.titles.confirmed"):i("investment.preview.titles.default")),g=s(()=>{const A={};return d.value.forEach((u,P)=>{A[o.tokenAddresses[P]]=u}),A}),C=s(()=>{const A={};return Object.keys(g.value).forEach(u=>{A[u]=m(u)}),A}),f=s(()=>{const A={};return Object.keys(g.value).forEach(u=>{A[u]=r(g.value[u],u)}),A}),I=s(()=>Object.values(f.value).reduce((A,u)=>N(A).plus(u).toString(),"0"));function V(){n.value&&h(),t("close")}function k(){V(),t("showStakeModal")}return _e(w,()=>t("close")),(A,u)=>{const P=Me,z=Ft,H=Ce,D=At;return l(),v(D,{show:"",fireworks:n.value,onClose:V},{header:q(()=>[R("div",jn,[n.value?(l(),v(z,{key:0,size:"8",color:"green",class:"mr-2 text-white"},{default:q(()=>[S(P,{name:"check"})]),_:1})):F("",!0),R("h4",null,L(e(W)),1)])]),default:q(()=>[S(ze,{amountMap:e(g),tokenMap:e(C),fiatAmountMap:e(f),fiatTotal:e(I)},null,8,["amountMap","tokenMap","fiatAmountMap","fiatTotal"]),S(Kt,{pool:a.pool,fiatTotal:e(I),priceImpact:e(c),highPriceImpact:e(p)},null,8,["pool","fiatTotal","priceImpact","highPriceImpact"]),e(b)?(l(),v(H,{key:0,type:"error",title:A.$t("investment.error.rektPriceImpact.title"),description:A.$t("investment.error.rektPriceImpact.description"),class:"mt-6 mb-2"},null,8,["title","description"])):F("",!0),S(Jn,{pool:a.pool,math:a.math,tokenAddresses:a.tokenAddresses,disabled:e(b),class:"mt-4",onSuccess:u[0]||(u[0]=X=>n.value=!0),onShowStakeModal:k},null,8,["pool","math","tokenAddresses","disabled"])]),_:1},8,["fireworks"])}}});function zn(a,t,o,n,i){const m=Q([]),r=Q(!1),d=Q(null),c=Q("0"),{toFiat:p,fNum:b}=ge(),{tokens:h,getToken:w,balances:W,balanceFor:g,nativeAsset:C}=le(),{minusSlippageScaled:f}=Vo(),{getSigner:I}=ue(),{managedPoolWithSwappingHalted:V,isComposableStableLikePool:k,isShallowComposableStablePool:A,isDeepPool:u}=se(a),{promises:P,processing:z,processAll:H}=Uo(),D=new Go(a,h,W,"join",n),X=new Rt(a),Y=s(()=>t.value.length),O=s(()=>t.value.map(y=>w(y))),x=s(()=>new Array(Y.value).fill("0").map((y,U)=>o.value[U]||"0")),B=s(()=>x.value.map((y,U)=>vt(y,O.value[U].decimals))),T=s(()=>{const U=B.value.map((te,Ie)=>[t.value[Ie].toLowerCase(),te]).filter(([,te])=>te.gt(0));return Object.fromEntries(U)}),E=s(()=>x.value.map((y,U)=>Je(U))),J=s(()=>E.value.reduce((y,U)=>N(y).plus(U).toString(),"0")),ae=s(()=>b(J.value,fe.fiat)),G=s(()=>x.value.some(y=>N(y).gt(0))),de=s(()=>{if(!G.value)return 0;try{return D.priceImpact(x.value,{queryBPT:pe.value.toString()}).toNumber()||0}catch(y){return gt(y),console.error(y),1}}),ke=s(()=>r.value?!1:N(de.value).isGreaterThanOrEqualTo($t)),Te=s(()=>r.value?!1:N(de.value).isGreaterThanOrEqualTo(Mt)),Se=s(()=>x.value.every((y,U)=>{if(ne(t.value[U],C.address)){const te=g(t.value[U]);return y===N(te).minus(C.minTransactionBuffer).toString()}else return y===g(t.value[U])})),Ae=s(()=>{const{send:y}=D.propMax();return x.value.every((U,te)=>U===y[te])}),pe=s(()=>{let y;if(u.value)y=d.value?N(d.value.amountTokenOut).abs().toString():"0";else if(A.value&&N(c.value).gt(0))y=c.value;else{if(!G.value)return"0";y=D.exactTokensInForBPTOut(x.value).toString()}return y}),$=s(()=>V.value?pe.value.toString():f(pe.value)),j=s(()=>t.value.map(y=>g(y))),ie=s(()=>j.value.map(y=>N(y).eq(0)).includes(!0)),re=s(()=>j.value.every(y=>N(y).eq(0))),me=s(()=>j.value.every(y=>N(y).gt(0))),ce=s(()=>a.value&&u.value&&G.value),Z=s(()=>!k.value);function ee(y){return x.value[y]||"0"}function Je(y){return p(ee(y),t.value[y])}function je(){x.value.forEach((y,U)=>{if(ne(t.value[U],C.address)){const te=g(t.value[U]);o.value[U]=N(te).gt(C.minTransactionBuffer)?N(te).minus(C.minTransactionBuffer).toString():"0"}else o.value[U]=g(t.value[U])})}function Re(){const{send:y}=D.propMax();o.value=[...y]}async function _(){r.value=!0,d.value=await Po(i,xo.vault.instance,Object.keys(T.value),Object.values(T.value),a.value.address.toLowerCase()),r.value=!1}async function ve(){if(A.value&&G.value)try{r.value=!0;const y=await X.queryJoin(I(),x.value,t.value,"0");c.value=y.bptOut.toString(),r.value=!1}catch(y){Bo("Failed to fetch query bptOut",y)}}return _e(x,async(y,U)=>{const te=y.findIndex((Ie,Xt)=>U[Xt]!==Ie);if(te>=0){await ve(),ce.value&&(P.value.push(_),z.value||H());const{send:Ie}=D.propAmountsGiven(x.value[te],te,"send");m.value=Ie}}),{hasAmounts:G,fullAmounts:x,fullAmountsScaled:B,batchSwapAmountMap:T,fiatTotal:J,fiatTotalLabel:ae,priceImpact:de,highPriceImpact:ke,rektPriceImpact:Te,maximized:Se,optimized:Ae,proportionalAmounts:m,batchSwap:d,bptOut:$,hasZeroBalance:ie,hasNoBalances:re,hasAllTokens:me,shouldFetchBatchSwap:ce,loadingData:r,supportsPropotionalOptimization:Z,maximizeAmounts:je,optimizeAmounts:Re,getBatchSwap:_}}const Hn={key:2,class:"p-2 pb-2 mt-4 rounded-lg border dark:border-gray-700"},Dn={class:"mt-4"},Un=K({__name:"InvestForm",props:{pool:null},setup(a){const t=a,o=Q(!1),n=Q(!1),{t:i}=he(),{balanceFor:m,nativeAsset:r,wrappedNativeAsset:d}=le(),{useNativeAsset:c}=Ge(),{tokenAddresses:p,amounts:b,validInputs:h,highPriceImpactAccepted:w,resetAmounts:W,sor:g}=et(),C=s(()=>t.pool),f=zn(C,p,b,c,g),{hasAmounts:I,highPriceImpact:V,maximizeAmounts:k,optimizeAmounts:A,proportionalAmounts:u,loadingData:P}=f,{isWalletReady:z,startConnectWithInjectedProvider:H,isMismatchedNetwork:D}=ue(),{managedPoolWithSwappingHalted:X,isWethPool:Y,isStableLikePool:O}=se(C),x=s(()=>h.value.every($=>$===!0)&&B.value),B=s(()=>V.value?w.value:!0),T=s(()=>X.value),E=s(()=>N(t.pool.totalLiquidity).lt(Ct)),J=s(()=>Fe(t.pool)?t.pool.mainTokens||[]:$o(t.pool));function ae($,j){b.value[j]=$,kt(()=>{T.value&&(b.value=[...u.value])})}function G($){c.value=ne($,r.address)}function de($){var j,ie,re,me;return Mo(t.pool.poolType)||!((ie=(j=t.pool)==null?void 0:j.onchain)!=null&&ie.tokens)?0:ne($,r.address)?((re=Ue(t.pool.onchain.tokens,d.value.address))==null?void 0:re.weight)||1:((me=Ue(t.pool.onchain.tokens,$))==null?void 0:me.weight)||1}function ke($){return O.value?"0.0":N(u.value[$]).gt(0)?u.value[$]:"0.0"}function Te($){return N(ke($)).gt(0)?i("proportionalSuggestion"):""}function Se($){return ne(t.pool.tokensList[$],d.value.address)?[d.value.address,r.address]:[]}function Ae(){const $=m(r.address),j=m(d.value.address);N($).gt(j)&&(pe("unwrapped"),c.value=!0)}function pe($){const j=$==="wrapped"?r.address:d.value.address,ie=$==="wrapped"?d.value.address:r.address,re=_t(p.value,j);re>=0&&(p.value[re]=ie)}return Ze(()=>{W(),p.value=[...J.value],Y.value&&Ae()}),_e(c,$=>{pe($?"unwrapped":"wrapped")}),($,j)=>{const ie=Ce,re=Et,me=qe;return l(),M("div",null,[e(T)?(l(),v(ie,{key:0,type:"warning",title:$.$t("investment.warning.managedPoolSwappingHalted.title"),description:$.$t("investment.warning.managedPoolSwappingHalted.description"),class:"mb-4"},null,8,["title","description"])):F("",!0),e(E)?(l(),v(ie,{key:1,type:"warning",title:$.$t("investment.warning.lowLiquidity.title"),description:$.$t("investment.warning.lowLiquidity.description"),class:"mb-4"},null,8,["title","description"])):F("",!0),(l(!0),M(xe,null,It(e(p).length,(ce,Z)=>(l(),v(Nt,{key:Z,address:e(p)[Z],"onUpdate:address":[ee=>e(p)[Z]=ee,j[0]||(j[0]=ee=>G(ee))],amount:e(b)[Z],"onUpdate:amount":[ee=>e(b)[Z]=ee,ee=>ae(ee,Z)],isValid:e(h)[Z],"onUpdate:isValid":ee=>e(h)[Z]=ee,name:e(p)[Z],weight:de(e(p)[Z]),hintAmount:ke(Z),hint:Te(Z),class:"mb-4",fixedToken:"",options:Se(Z)},null,8,["address","onUpdate:address","amount","onUpdate:amount","isValid","onUpdate:isValid","name","weight","hintAmount","hint","options"]))),128)),S(qn,{math:e(f),onMaximize:e(k),onOptimize:e(A)},null,8,["math","onMaximize","onOptimize"]),e(V)?(l(),M("div",Hn,[S(re,{modelValue:e(w),"onUpdate:modelValue":j[1]||(j[1]=ce=>Xe(w)?w.value=ce:null),rules:[e(Lt)($.$t("priceImpactCheckbox"))],name:"highPriceImpactAccepted",size:"sm",label:$.$t("priceImpactAccept",[$.$t("depositing")])},null,8,["modelValue","rules","label"])])):F("",!0),S(Zt,{pool:e(C),class:"mt-4"},null,8,["pool"]),R("div",Dn,[e(z)?(l(),v(me,{key:1,label:$.$t("preview"),color:"gradient",disabled:!e(I)||!e(x)||e(D)||e(P),block:"",onClick:j[2]||(j[2]=ce=>o.value=!0)},null,8,["label","disabled"])):(l(),v(me,{key:0,label:$.$t("connectWallet"),color:"gradient",block:"",onClick:e(H)},null,8,["label","onClick"]))]),(l(),v(Pt,{to:"#modal"},[o.value?(l(),v(Rn,{key:0,pool:e(C),math:e(f),tokenAddresses:e(p),onClose:j[3]||(j[3]=ce=>o.value=!1),onShowStakeModal:j[4]||(j[4]=ce=>n.value=!0)},null,8,["pool","math","tokenAddresses"])):F("",!0),S(Ot,{pool:e(C),isVisible:n.value,action:"stake",onClose:j[5]||(j[5]=ce=>n.value=!1)},null,8,["pool","isVisible"])]))])}}}),Gn={key:1},Qn=K({__name:"InvestActionsV2",props:{pool:null},emits:["success","showStakeModal"],setup(a,{emit:t}){const o=a,{t:n}=he(),{fNum:i}=ge(),{addTransaction:m}=bt(),{txListener:r,getTxConfirmedAt:d}=wt(),{lockablePoolId:c}=Ke(),{isStakablePool:p}=qt(),{poolWeightsLabel:b}=se(ye(o,"pool")),{rektPriceImpact:h,fiatValueOut:w,join:W,txState:g,resetTxState:C,approvalActions:f}=we(),I=Q(f.value),V=s(()=>[...I.value,{label:n("addLiquidity"),loadingLabel:n("investment.preview.loadingLabel.investment"),confirmingLabel:n("confirming"),action:A,stepTooltip:n("investmentTooltip")}]);async function k(u){m({id:u.hash,type:"tx",action:"invest",summary:n("transactionSummary.investInPool",[i(w.value,fe.fiat),b(o.pool)]),details:{total:i(w.value,fe.fiat),pool:o.pool}}),await r(u,{onTxConfirmed:async P=>{t("success",P),g.receipt=P;const z=await d(P);g.confirmedAt=St(z),g.confirmed=!0,g.confirming=!1},onTxFailed:()=>{console.error("Invest failed"),g.confirming=!1}})}Co(()=>{C()});async function A(){g.init=!0;try{const u=await W();return g.confirming=!0,k(u),u}catch(u){throw g.confirming=!1,new Error("Failed to submit transaction.",{cause:u})}finally{g.init=!1}}return(u,P)=>{const z=Vt,H=qe;return l(),v(Tt,null,{default:q(()=>[!e(g).confirmed||!e(g).receipt?(l(),v(Jt,{key:0,actions:e(V),disabled:e(h)},null,8,["actions","disabled"])):(l(),M("div",Gn,[S(jt,{txReceipt:e(g).receipt},null,8,["txReceipt"]),e(c)===a.pool.id?(l(),v(H,{key:0,tag:"router-link",to:{name:"get-vebal"},color:"gradient",block:"",class:"flex mt-2"},{default:q(()=>[S(z,{class:"mr-2 h-5 text-orange-300"}),oe(L(u.$t("lockToGetVeBAL")),1)]),_:1})):e(p)?(l(),v(H,{key:1,color:"gradient",block:"",class:"flex mt-2",onClick:P[0]||(P[0]=D=>t("showStakeModal"))},{default:q(()=>[S(z,{class:"mr-2 h-5 text-orange-300"}),oe(L(u.$t("stakeToGetExtra")),1)]),_:1})):F("",!0),S(H,{tag:"router-link",to:{name:"pool",params:{id:a.pool.id}},color:"gray",outline:"",block:"",class:"mt-2"},{default:q(()=>[oe(L(u.$t("returnToPool")),1)]),_:1},8,["to"])]))]),_:1})}}}),Yn={class:"flex items-center"},Zn=K({__name:"InvestPreviewModalV2",props:{pool:null},emits:["close","showStakeModal"],setup(a,{emit:t}){const o=a,n=Q(!1),{t:i}=he(),{getToken:m}=le(),{toFiat:r}=ge(),{isSingleAssetJoin:d,amountsIn:c,bptOut:p,fiatValueIn:b,fiatValueOut:h,priceImpact:w,highPriceImpact:W,rektPriceImpact:g,isLoadingQuery:C,txInProgress:f,queryJoinQuery:I,missingPricesIn:V,resetAmounts:k}=we(),A=s(()=>n.value?i("investment.preview.titles.confirmed"):i("investment.preview.titles.default")),u=s(()=>!!Object.keys(D.value).length),P=s(()=>{const T={};return c.value.forEach(E=>{T[E.address]=E.value}),T}),z=s(()=>({[o.pool.address]:p.value})),H=s(()=>{const T={};return Object.keys(P.value).forEach(E=>{T[E]=m(E)}),T}),D=s(()=>({[o.pool.address]:m(o.pool.address)})),X=s(()=>{const T={};return Object.keys(P.value).forEach(E=>{T[E]=r(P.value[E],E)}),T}),Y=s(()=>h.value?{[o.pool.address]:h.value}:{}),O=s(()=>Object.values(Y.value).reduce((T,E)=>N(T).plus(E).toString(),"0"));function x(){n.value&&(k(),n.value=!1),t("close")}function B(){x(),t("showStakeModal")}return xt(()=>{!C.value&&!f.value&&I.refetch()},Bt*10),(T,E)=>{const J=Me,ae=Ft,G=Ce,de=At;return l(),v(de,{show:"",fireworks:n.value,onClose:x},{header:q(()=>[R("div",Yn,[n.value?(l(),v(ae,{key:0,size:"8",color:"green",class:"mr-2 text-white"},{default:q(()=>[S(J,{name:"check"})]),_:1})):F("",!0),R("h4",null,L(e(A)),1)])]),default:q(()=>[S(ze,{title:T.$t("investment.preview.titles.tokenIn"),amountMap:e(P),tokenMap:e(H),fiatAmountMap:e(X),fiatTotal:e(b),hideAmountShare:e(d)},null,8,["title","amountMap","tokenMap","fiatAmountMap","fiatTotal","hideAmountShare"]),e(u)?(l(),v(ze,{key:0,showZeroAmounts:"",title:T.$t("investment.preview.titles.tokenOut"),class:"mt-4",amountMap:e(z),tokenMap:e(D),fiatAmountMap:e(Y),fiatTotal:e(O),hideAmountShare:""},null,8,["title","amountMap","tokenMap","fiatAmountMap","fiatTotal"])):F("",!0),e(V)?(l(),v(G,{key:1,type:"warning",title:T.$t("noPriceInfo"),class:"mt-4",block:""},null,8,["title"])):F("",!0),S(Kt,{pool:a.pool,fiatTotal:e(V)?"-":e(b),priceImpact:e(w),highPriceImpact:e(W)},null,8,["pool","fiatTotal","priceImpact","highPriceImpact"]),e(g)?(l(),v(G,{key:2,type:"error",title:T.$t("investment.error.rektPriceImpact.title"),description:T.$t("investment.error.rektPriceImpact.description"),class:"mt-6 mb-2"},null,8,["title","description"])):F("",!0),S(Qn,{pool:a.pool,class:"mt-4",onSuccess:E[0]||(E[0]=ke=>n.value=!0),onShowStakeModal:B},null,8,["pool"])]),_:1},8,["fireworks"])}}}),Kn={class:"data-table"},Xn={class:"p-2"},es={class:"data-table-number-col"},ts={class:"flex"},os={key:0},ns=K({__name:"InvestFormTotalsV2",setup(a){const{highPriceImpact:t,isLoadingQuery:o,priceImpact:n}=we(),{fNum:i}=ge(),m=s(()=>({"dark:bg-gray-800":!t.value,"bg-red-500 dark:bg-red-500 text-white divide-red-400":t.value}));return(r,d)=>{const c=Be,p=Me,b=$e;return l(),M("div",Kn,[R("div",{class:Ee(["data-table-row price-impact-row",e(m)])},[R("div",Xn,L(r.$t("priceImpact")),1),R("div",es,[R("div",ts,[e(o)?(l(),v(c,{key:1,class:"w-10"})):(l(),M("span",os,L(e(i)(e(n),e(fe).percent)),1)),S(b,{text:r.$t("customAmountsTip")},{activator:q(()=>[e(t)?(l(),v(p,{key:0,name:"alert-triangle",size:"xs",class:"-mb-px ml-1"})):(l(),v(p,{key:1,name:"info",size:"xs",class:"-mb-px ml-1 text-gray-400"}))]),_:1},8,["text"])])])],2)])}}});const ss=be(ns,[["__scopeId","data-v-24a87fcf"]]),as={key:1,class:"italic-warning"},ls=K({__name:"MissingPoolTokensAlert",props:{poolTokensWithoutBalance:null,poolTokensWithBalance:null,showSingleTokenSuggestion:{type:Boolean}},setup(a){const t=a,{t:o}=he(),{getToken:n}=le(),i=s(()=>t.poolTokensWithoutBalance.map(d=>{var c;return(c=n(d))==null?void 0:c.symbol})),m=s(()=>Lo(i.value,o)),r=s(()=>{const d=t.showSingleTokenSuggestion?` 

${o("investment.warning.noPoolTokensToJoinWith.paragraph2")}`:"";return o("investment.warning.noPoolTokensToJoinWith.paragraph1")+d});return(d,c)=>{const p=Ce;return a.poolTokensWithBalance.length?e(i).length?(l(),M("div",as,L(e(o)("investment.warning.noBalanceSomeTokens"))+": "+L(e(m)),1)):F("",!0):(l(),v(p,{key:0,class:"mb-4",type:"warning",title:e(o)("investment.warning.noPoolTokensToJoinWith.title"),description:e(r)},null,8,["title","description"]))}}});const is=be(ls,[["__scopeId","data-v-dc6f715f"]]),rs={key:3,class:"p-2 pb-2 mt-5 rounded-lg border dark:border-gray-700 high-price-impact"},cs={class:"mt-4"},us=K({__name:"InvestFormV2",props:{pool:null},setup(a){const t=a,o=Q(!1),n=Q(!1),{managedPoolWithSwappingHalted:i,isDeepPool:m,isPreMintedBptPool:r}=se(ye(t,"pool")),{veBalTokenInfo:d}=Ke(),{isWalletReady:c,startConnectWithInjectedProvider:p,isMismatchedNetwork:b}=ue(),{wrappedNativeAsset:h}=le(),{isLoadingQuery:w,isSingleAssetJoin:W,amountsIn:g,highPriceImpact:C,highPriceImpactAccepted:f,hasValidInputs:I,hasAmountsIn:V,queryError:k,setAmountsIn:A,addTokensIn:u}=we(),{poolTokensWithBalance:P,isLoadingBalances:z,poolTokensWithoutBalance:H}=Dt({pool:t.pool,includeNativeAsset:!0}),D=s(()=>i.value),X=s(()=>N(t.pool.totalLiquidity).lt(Ct));async function Y(O){A([]),O?u([h.value.address]):(await Wo(z,!1),u(P.value))}return Ze(()=>{Y(W.value)}),_e([W,P],([O,x],[B,T])=>{if(!o.value){const E=B!==O;(!rt.isEqual(T,x)||E)&&Y(O)}}),(O,x)=>{const B=Ce,T=Et,E=qe;return l(),M("div",null,[e(D)?(l(),v(B,{key:0,type:"warning",title:O.$t("investment.warning.managedPoolSwappingHalted.title"),description:O.$t("investment.warning.managedPoolSwappingHalted.description"),class:"mb-5"},null,8,["title","description"])):F("",!0),e(X)?(l(),v(B,{key:1,type:"warning",title:O.$t("investment.warning.lowLiquidity.title"),description:O.$t("investment.warning.lowLiquidity.description"),class:"mb-5"},null,8,["title","description"])):F("",!0),(l(!0),M(xe,null,It(e(g),J=>{var ae;return l(),v(Nt,{key:J.address,isValid:J.valid,"onUpdate:isValid":G=>J.valid=G,address:J.address,"onUpdate:address":G=>J.address=G,amount:J.value,"onUpdate:amount":G=>J.value=G,name:J.address,class:"mb-4",fixedToken:!e(W),excludedTokens:[(ae=e(d))==null?void 0:ae.address,a.pool.address]},null,8,["isValid","onUpdate:isValid","address","onUpdate:address","amount","onUpdate:amount","name","fixedToken","excludedTokens"])}),128)),e(W)?F("",!0):(l(),v(is,{key:2,showSingleTokenSuggestion:e(m)&&e(r),poolTokensWithBalance:e(P),poolTokensWithoutBalance:e(H)},null,8,["showSingleTokenSuggestion","poolTokensWithBalance","poolTokensWithoutBalance"])),S(ss),e(C)?(l(),M("div",rs,[S(T,{modelValue:e(f),"onUpdate:modelValue":x[0]||(x[0]=J=>Xe(f)?f.value=J:null),rules:[e(Lt)(O.$t("priceImpactCheckbox"))],name:"highPriceImpactAccepted",size:"sm",label:O.$t("priceImpactAccept",[O.$t("depositing")])},null,8,["modelValue","rules","label"])])):F("",!0),S(Zt,{pool:a.pool,class:"mt-5"},null,8,["pool"]),e(k)?(l(),v(B,{key:4,type:"error",title:O.$t("thereWasAnError"),description:e(k),class:"mt-4",block:""},null,8,["title","description"])):F("",!0),R("div",cs,[e(c)?(l(),v(E,{key:1,label:O.$t("preview"),color:"gradient",disabled:!e(V)||!e(I)||e(b)||e(w)||!!e(k),block:"",onClick:x[1]||(x[1]=J=>o.value=!0)},null,8,["label","disabled"])):(l(),v(E,{key:0,label:O.$t("connectWallet"),color:"gradient",block:"",onClick:e(p)},null,8,["label","onClick"]))]),(l(),v(Pt,{to:"#modal"},[o.value?(l(),v(Zn,{key:0,pool:a.pool,onClose:x[2]||(x[2]=J=>o.value=!1),onShowStakeModal:x[3]||(x[3]=J=>n.value=!0)},null,8,["pool"])):F("",!0),S(Ot,{pool:a.pool,isVisible:n.value,action:"stake",onClose:x[4]||(x[4]=J=>n.value=!1)},null,8,["pool","isVisible"])]))])}}});const ds=be(us,[["__scopeId","data-v-56adaf62"]]),ps={class:"w-full"},ms={class:"text-xs leading-none text-secondary"},vs={class:"flex justify-between items-center"},fs=K({__name:"InvestPageInvestBlock",props:{pool:null},setup(a){const t=a,o=s(()=>t.pool),{network:n}=Qe,{activeTab:i,resetTabs:m}=Gt(),{isDeepPool:r,isPreMintedBptPool:d}=se(o),{setIsSingleAssetJoin:c}=we();return _e(i,p=>{c(p===tt.SingleToken)}),ht(()=>m()),(p,b)=>{const h=Ho,w=pt;return l(),v(w,{shadow:"xl",exposeOverflow:"",noBorder:""},{header:q(()=>[R("div",ps,[R("div",ms,L(e(n).chainName),1),R("div",vs,[R("h4",null,L(p.$t("addLiquidity")),1),S(Ko,{context:e(Zo).invest},null,8,["context"])]),e(r)&&e(d)?(l(),v(h,{key:0,modelValue:e(i),"onUpdate:modelValue":b[0]||(b[0]=W=>Xe(i)?i.value=W:null),tabs:e(Ve),class:"p-0 m-0 -mb-px whitespace-nowrap",noPad:""},null,8,["modelValue","tabs"])):F("",!0)])]),default:q(()=>[e(r)?(l(),v(ds,{key:0,pool:e(o)},null,8,["pool"])):(l(),v(Un,{key:1,pool:e(o)},null,8,["pool"]))]),_:1})}}}),hs={class:"invest-page-layout-grid"},gs={key:0,class:"col-span-5"},ks={class:"col-span-7"},_s=K({__name:"InvestPage",props:{pool:null},setup(a){const t=a,o=s(()=>t.pool),{isDeepPool:n}=se(o),{upToLargeBreakpoint:i}=dt();return wn(o),(m,r)=>(l(),M("div",hs,[e(i)?F("",!0):(l(),M("div",gs,[S(Yt,{pool:e(o)},null,8,["pool"])])),R("div",ks,[S(fs,{pool:e(o)},null,8,["pool"])]),e(i)?(l(),v(Tn,{key:1,pool:e(o),class:"mt-4",isDeepPool:e(n)},null,8,["pool","isDeepPool"])):F("",!0)]))}});const ys=be(_s,[["__scopeId","data-v-63757584"]]),bs={class:"px-4 lg:px-0 mx-auto max-w-3xl"},Zs=K({__name:"add-liquidity",setup(a){const o=Eo().params.id.toLowerCase();Do(o),so();const{pool:n,poolDecorationQuery:i,loadingPool:m,transfersAllowed:r}=Ge(),{isDeepPool:d}=se(n),c=s(()=>d.value&&!Ye.value),p=s(()=>m.value&&!r.value&&c.value);return xt(i.refetch,Bt*20),(b,h)=>{const w=Be;return l(),M("div",bs,[e(p)||!e(n)?(l(),v(w,{key:0,class:"h-96"})):(l(),v(ys,{key:1,pool:e(n)},null,8,["pool"]))])}}});export{Zs as default};
//# sourceMappingURL=add-liquidity-6134c572.js.map
