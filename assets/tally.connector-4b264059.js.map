{"version":3,"file":"tally.connector-4b264059.js","sources":["../../src/services/web3/connectors/tally/tally.connector.ts"],"sourcesContent":["import { WalletError } from '@/types';\r\n\r\nimport { Connector, ConnectorId } from '../connector';\r\n\r\nexport class TallyConnector extends Connector {\r\n  id = ConnectorId.InjectedTally;\r\n  async connect() {\r\n    const provider =\r\n      (window as any).ethereum ||\r\n      ((window as any).web3 && (window as any).web3.currentProvider);\r\n\r\n    if (provider) {\r\n      this.provider = provider;\r\n      this.active.value = true;\r\n\r\n      let accounts = null;\r\n      let chainId = null;\r\n      // try the best practice way of get accounts with eth_requestAccounts && eth_chainId\r\n      try {\r\n        if (provider.request) {\r\n          accounts = await provider.request({\r\n            method: 'eth_requestAccounts',\r\n          });\r\n\r\n          chainId = await provider.request({ method: 'eth_chainId' });\r\n        }\r\n      } catch (err) {\r\n        if ((err as WalletError).code === 4001) {\r\n          // EIP-1193 userRejectedRequest error\r\n          // If this happens, the user rejected the connection request.\r\n          console.log('Please connect to MetaMask.');\r\n        } else {\r\n          console.error(err);\r\n        }\r\n      }\r\n\r\n      // if account is still moot, try the bad old way - enable()\r\n      if (!accounts) {\r\n        // have to any it, since enable technically shouldn't be there anymore.\r\n        // but might, for legacy clients.\r\n        const response = await (provider as any).enable();\r\n        accounts = response?.result || response;\r\n      }\r\n\r\n      if (accounts && chainId) {\r\n        this.handleChainChanged(chainId);\r\n        this.handleAccountsChanged(accounts);\r\n      }\r\n    } else {\r\n      console.error(\r\n        'Tried to connect to MetaMask but it was not detected. Please install MetaMask.'\r\n      );\r\n    }\r\n    return {\r\n      // TODO type this\r\n      provider: provider as any,\r\n      account: this.account,\r\n      chainId: this.chainId,\r\n    };\r\n  }\r\n}\r\n"],"names":["TallyConnector","Connector","__publicField","ConnectorId","provider","accounts","chainId","err","response"],"mappings":"yNAIO,MAAMA,UAAuBC,CAAU,CAAvC,kCACLC,EAAA,UAAKC,EAAY,eACjB,MAAM,SAAU,CACd,MAAMC,EACH,OAAe,UACd,OAAe,MAAS,OAAe,KAAK,gBAEhD,GAAIA,EAAU,CACZ,KAAK,SAAWA,EAChB,KAAK,OAAO,MAAQ,GAEpB,IAAIC,EAAW,KACXC,EAAU,KAEV,GAAA,CACEF,EAAS,UACAC,EAAA,MAAMD,EAAS,QAAQ,CAChC,OAAQ,qBAAA,CACT,EAEDE,EAAU,MAAMF,EAAS,QAAQ,CAAE,OAAQ,cAAe,SAErDG,GACFA,EAAoB,OAAS,KAGhC,QAAQ,IAAI,6BAA6B,EAEzC,QAAQ,MAAMA,CAAG,CAErB,CAGA,GAAI,CAACF,EAAU,CAGP,MAAAG,EAAW,MAAOJ,EAAiB,SACzCC,GAAWG,GAAA,YAAAA,EAAU,SAAUA,CACjC,CAEIH,GAAYC,IACd,KAAK,mBAAmBA,CAAO,EAC/B,KAAK,sBAAsBD,CAAQ,EACrC,MAEQ,QAAA,MACN,gFAAA,EAGG,MAAA,CAEL,SAAAD,EACA,QAAS,KAAK,QACd,QAAS,KAAK,OAAA,CAElB,CACF"}