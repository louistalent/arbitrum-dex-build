{"version":3,"file":"gnosis.connector-1f35f49f.js","sources":["../../node_modules/@gnosis.pm/safe-apps-provider/dist/utils.js","../../node_modules/@gnosis.pm/safe-apps-provider/dist/provider.js","../../node_modules/@gnosis.pm/safe-apps-provider/dist/index.js","../../src/services/web3/connectors/gnosis/gnosis.connector.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getLowerCase = void 0;\nfunction getLowerCase(value) {\n    if (value) {\n        return value.toLowerCase();\n    }\n    return value;\n}\nexports.getLowerCase = getLowerCase;\n//# sourceMappingURL=utils.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SafeAppProvider = void 0;\nconst events_1 = require(\"events\");\nconst utils_1 = require(\"./utils\");\n// The API is based on Ethereum JavaScript API Provider Standard. Link: https://eips.ethereum.org/EIPS/eip-1193\nclass SafeAppProvider {\n    constructor(safe, sdk) {\n        this.submittedTxs = new Map();\n        this.events = new events_1.EventEmitter();\n        this.safe = safe;\n        this.sdk = sdk;\n    }\n    async connect() {\n        this.events.emit('connect', { chainId: this.chainId });\n        return;\n    }\n    async disconnect() {\n        return;\n    }\n    on(event, listener) {\n        this.events.on(event, listener);\n    }\n    once(event, listener) {\n        this.events.once(event, listener);\n    }\n    off(event, listener) {\n        this.events.off(event, listener);\n    }\n    removeListener(event, listener) {\n        this.events.removeListener(event, listener);\n    }\n    get chainId() {\n        return this.safe.chainId;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    async request(request) {\n        const { method, params = [] } = request;\n        switch (method) {\n            case 'eth_accounts':\n                return [this.safe.safeAddress];\n            case 'net_version':\n            case 'eth_chainId':\n                return `0x${this.chainId.toString(16)}`;\n            case 'eth_sendTransaction':\n                const tx = Object.assign({ value: '0', data: '0x' }, params[0]);\n                const resp = await this.sdk.txs.send({\n                    txs: [tx],\n                });\n                // Store fake transaction\n                this.submittedTxs.set(resp.safeTxHash, {\n                    from: this.safe.safeAddress,\n                    hash: resp.safeTxHash,\n                    gas: 0,\n                    gasPrice: '0x00',\n                    nonce: 0,\n                    input: tx.data,\n                    value: tx.value,\n                    to: tx.to,\n                    blockHash: null,\n                    blockNumber: null,\n                    transactionIndex: null,\n                });\n                return resp.safeTxHash;\n            case 'eth_blockNumber':\n                const block = await this.sdk.eth.getBlockByNumber(['latest']);\n                return block.number;\n            case 'eth_getBalance':\n                return this.sdk.eth.getBalance([utils_1.getLowerCase(params[0]), params[1]]);\n            case 'eth_getCode':\n                return this.sdk.eth.getCode([utils_1.getLowerCase(params[0]), params[1]]);\n            case 'eth_getStorageAt':\n                return this.sdk.eth.getStorageAt([utils_1.getLowerCase(params[0]), params[1], params[2]]);\n            case 'eth_getBlockByNumber':\n                return this.sdk.eth.getBlockByNumber([params[0], params[1]]);\n            case 'eth_getBlockByHash':\n                return this.sdk.eth.getBlockByHash([params[0], params[1]]);\n            case 'eth_getTransactionByHash':\n                let txHash = params[0];\n                try {\n                    const resp = await this.sdk.txs.getBySafeTxHash(txHash);\n                    txHash = resp.txHash || txHash;\n                }\n                catch (e) { }\n                // Use fake transaction if we don't have a real tx hash\n                if (this.submittedTxs.has(txHash)) {\n                    return this.submittedTxs.get(txHash);\n                }\n                return this.sdk.eth.getTransactionByHash([txHash]).then((tx) => {\n                    // We set the tx hash to the one requested, as some provider assert this\n                    if (tx) {\n                        tx.hash = params[0];\n                    }\n                    return tx;\n                });\n            case 'eth_getTransactionReceipt': {\n                let txHash = params[0];\n                try {\n                    const resp = await this.sdk.txs.getBySafeTxHash(txHash);\n                    txHash = resp.txHash || txHash;\n                }\n                catch (e) { }\n                return this.sdk.eth.getTransactionReceipt([txHash]).then((tx) => {\n                    // We set the tx hash to the one requested, as some provider assert this\n                    if (tx) {\n                        tx.transactionHash = params[0];\n                    }\n                    return tx;\n                });\n            }\n            case 'eth_estimateGas': {\n                return 0;\n            }\n            case 'eth_call': {\n                return this.sdk.eth.call([params[0], params[1]]);\n            }\n            case 'eth_getLogs':\n                return this.sdk.eth.getPastLogs([params[0]]);\n            default:\n                throw Error(`\"${request.method}\" not implemented`);\n        }\n    }\n    // this method is needed for ethers v4\n    // https://github.com/ethers-io/ethers.js/blob/427e16826eb15d52d25c4f01027f8db22b74b76c/src.ts/providers/web3-provider.ts#L41-L55\n    send(request, callback) {\n        if (!request)\n            callback('Undefined request');\n        this.request(request)\n            .then((result) => callback(null, { jsonrpc: '2.0', id: request.id, result }))\n            .catch((error) => callback(error, null));\n    }\n}\nexports.SafeAppProvider = SafeAppProvider;\n//# sourceMappingURL=provider.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SafeAppProvider = void 0;\nvar provider_1 = require(\"./provider\");\nObject.defineProperty(exports, \"SafeAppProvider\", { enumerable: true, get: function () { return provider_1.SafeAppProvider; } });\n//# sourceMappingURL=index.js.map","import { SafeAppProvider } from '@gnosis.pm/safe-apps-provider';\r\nimport SafeAppsSDK from '@gnosis.pm/safe-apps-sdk';\r\n\r\nimport { Connector, ConnectorId } from '../connector';\r\n\r\nexport class SafeConnector extends Connector {\r\n  id = ConnectorId.Gnosis;\r\n  async connect() {\r\n    const sdk = new SafeAppsSDK();\r\n    const safe = await sdk.safe.getInfo();\r\n\r\n    const provider = new SafeAppProvider(safe, sdk);\r\n\r\n    if (provider) {\r\n      this.provider = provider;\r\n      this.active.value = true;\r\n      this.handleChainChanged(safe.chainId);\r\n      this.handleAccountsChanged([safe.safeAddress]);\r\n    } else {\r\n      console.error(\r\n        'Tried to connect to Gnosis Safe but it was not detected. Please install make sure you are using the Gnosis interface.'\r\n      );\r\n    }\r\n    return {\r\n      // TODO type this\r\n      provider: provider as any,\r\n      account: this.account,\r\n      chainId: this.chainId,\r\n    };\r\n  }\r\n}\r\n"],"names":["utils","getLowerCase","value","provider","events_1","require$$0","utils_1","require$$1","SafeAppProvider","safe","sdk","event","listener","request","method","params","tx","resp","txHash","callback","result","error","exports","provider_1","SafeConnector","Connector","__publicField","ConnectorId","SafeAppsSDK"],"mappings":"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","x_google_ignoreList":[0,1,2]}